<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
  
  <!-- Google Site Verification -->
  <meta name="google-site-verification" content="P8-swUXw68i3R0JY_qb79WkkHeJkQke_jFussifj4yQ" />

  <!-- Title -->
  <title>Kitten Clicker ‚Äî Free Online Idle Cat Clicker Game</title>

  <!-- Favicon -->
  <link rel="icon" href="https://cdn.pixabay.com/photo/2025/10/17/11/52/kitten-9900082_1280.png" type="image/png">

  <!-- SEO Meta -->
  <meta name="description" content="Play Kitten Clicker online! Click adorable kittens, unlock rare breeds, and grow your kitty empire in this fun idle cat clicker game. Free browser game.">
  <meta name="keywords" content="kitten clicker, kitty clicker, cat clicker, idle kitten game, incremental kitten game, idle cat simulator, online kitten game, browser cat clicker, kitten collecting game, kitty collecting game, incremental cat game">
  <meta name="author" content="Fangdootle">
  <meta name="robots" content="index, follow">

  <!-- Open Graph / Social Sharing -->
  <meta property="og:title" content="Kitten Clicker ‚Äî Free Online Idle Cat Clicker Game" />
  <meta property="og:description" content="Click adorable kittens, unlock rare breeds, and grow your kitty empire in this fun idle cat clicker game. Play for free online!" />
  <meta property="og:image" content="https://media.istockphoto.com/id/1298894806/photo/cute-little-kitten-on-white-background.jpg?s=1024x1024&w=is&k=20&c=k-4xXxC-edWBKhggUXx2ODybogJrcevJydeVHeEwe4o=" />
  <meta property="og:url" content="https://https://kittenclicker.vercel.app" />
  <meta property="og:type" content="game" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Kitten Clicker ‚Äî Free Online Idle Cat Clicker Game" />
  <meta name="twitter:description" content="Click adorable kittens, unlock rare breeds, and grow your kitty empire in this fun idle cat clicker game. Play for free online!" />
  <meta name="twitter:image" content="https://media.istockphoto.com/id/1298894806/photo/cute-little-kitten-on-white-background.jpg?s=1024x1024&w=is&k=20&c=k-4xXxC-edWBKhggUXx2ODybogJrcevJydeVHeEwe4o=" />

  <!-- Structured Data (JSON-LD for SEO) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Game",
    "name": "Kitten Clicker",
    "url": "https://https://kittenclicker.vercel.app",
    "image": "https://media.istockphoto.com/id/1298894806/photo/cute-little-kitten-on-white-background.jpg?s=1024x1024&w=is&k=20&c=k-4xXxC-edWBKhggUXx2ODybogJrcevJydeVHeEwe4o=",
    "description": "Click adorable kittens, unlock rare breeds, and grow your kitty empire in this fun idle cat clicker game.",
    "author": {
      "@type": "Person",
      "name": "Fangdootle"
    },
    "gamePlatform": "Browser",
    "genre": "Idle Clicker, Incremental Game"
  }
  </script>

  <!-- Optional: Canonical URL -->
  <link rel="canonical" href="https://https://kittenclicker.vercel.app" />
  <!-- Styles -->
  <style>
  html, body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  body {
    padding-top: 80px;
    background: linear-gradient(135deg, #f8bbd0, #e1bee7);
    color: #880e4f;
    transition: background 0.5s ease, color 0.5s ease;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }

  body::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 20%);
    z-index: -1;
  }

  h1 {
    margin-bottom: 0;
    font-size: 2.8rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    background: linear-gradient(to right, #c2185b, #e91e63);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 1px;
  }

  #score {
    font-size: 1.8rem;
    margin: 10px 0 15px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
  }

  #stats {
    margin: 10px auto 15px; /* Changed to auto for left/right to center block element */
    font-size: 1.4rem;
    background: rgba(255, 255, 255, 0.7);
    padding: 12px 20px;
    border-radius: 20px;
    display: block; /* Changed from inline-block to block */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    width: fit-content; /* Make it fit its content, then center with auto margins */
    max-width: 400px;
  }

  img#kitten {
    width: 320px;
    cursor: pointer;
    border-radius: 25px;
    transition: all 0.3s ease;
    position: relative;
    z-index: 10;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    border: 5px solid white;
    pointer-events: auto;
    touch-action: manipulation;
  }

  img#kitten:hover {
    transform: scale(1.05);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
  }

  .pulse {
    animation: pulseAnim 0.3s ease forwards;
  }

  @keyframes pulseAnim {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1); }
  }

  /* Falling kitten emojis */
  .falling-kitten {
    position: fixed;
    font-size: 28px;
    z-index: 1;
    pointer-events: none;
    animation: fall linear forwards;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
  }

  @keyframes fall {
    to {
      transform: translateY(100vh) rotate(360deg);
    }
  }

  /* Top buttons */
  .top-buttons {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 1001;
  }

  .top-buttons button {
    padding: 12px 22px;
    font-size: 16px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: linear-gradient(to right, #c2185b, #e91e63);
    color: white;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .top-buttons button:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
  }

  .top-buttons button:active {
    transform: translateY(1px);
  }

  #comboMeter {
    position: fixed;
    top: 80px;
    right: 20px;
    padding: 10px 14px;
    border-radius: 12px;
    background: linear-gradient(to right, #ff9800, #ffc107);
    color: #4a2c2c;
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    z-index: 1001;
    display: none;
  }

  #goldenKittenEl {
    position: fixed;
    display: none;
    font-size: 36px;
    cursor: pointer;
    z-index: 1002;
    filter: drop-shadow(0 2px 6px rgba(255, 215, 0, 0.7));
    transition: transform 0.2s ease;
  }
  #goldenKittenEl:hover { transform: scale(1.15); }

  /* Shop overlay */
  #shopOverlay {
    /* display controlled by openOverlay; when open, we set to flex */
    flex-direction: column;
    padding: 60px 20px 20px;
  }

  #shopOverlay .shop-content {
    flex: 1;
    overflow-y: auto;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
  }

  .shop-header {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px dashed #f8bbd0;
    text-align: center;
  }
  
  .shop-header h2 {
    margin: 0;
    color: #c2185b;
  }

  .closeOverlay {
    position: absolute;
    top: 15px;
    left: 15px;
    background: #b71c1c;
    color: white;
    border: none;
    padding: 8px 12px;
    font-size: 20px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 1001;
    transition: all 0.2s;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .closeOverlay:hover {
    background: #d32f2f;
    transform: rotate(90deg);
  }

  .shop-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 25px;
    border-bottom: 2px solid #f8bbd0;
    padding-bottom: 12px;
    gap: 8px;
  }

  .shop-tab {
    padding: 10px 20px;
    background: #f8bbd0;
    border: none;
    border-radius: 12px 12px 0 0;
    cursor: pointer;
    font-weight: bold;
    margin: 0 5px;
    transition: all 0.2s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  .shop-tab:hover {
    background: #e91e63;
    color: white;
    transform: translateY(-2px);
  }

  .shop-tab.active {
    background: #c2185b;
    color: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  .shop-tab-content {
    display: none;
    flex: 1;
    overflow-y: auto;
  }

  .shop-tab-content.active {
    display: block;
  }

  #shopOverlay.christmas-shop {
    background: radial-gradient(circle at 20% 10%, #fffafa 0%, #f8bbd0 60%), linear-gradient(145deg, #e0f2f1, #ffffff);
  }
  #shopOverlay.christmas-shop .shop-header {
    border-bottom-color: #d32f2f;
  }
  #shopOverlay.christmas-shop .shop-header h2 {
    color: #d32f2f;
  }
  #shopOverlay.christmas-shop .shop-tab {
    background: #e8f5e9;
    color: #1b5e20;
  }
  #shopOverlay.christmas-shop .shop-tab.active {
    background: #1b5e20;
    color: #ffffff;
  }
  #shopOverlay.christmas-shop .shop-item {
    background: linear-gradient(145deg, #e8f5e9, #ffffff);
    border-color: rgba(255, 255, 255, 0.8);
    box-shadow: 0 6px 18px rgba(27, 94, 32, 0.2);
  }

  /* Shop items */
  .shop-item {
    margin: 18px 0;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    background: linear-gradient(145deg, #f8bbd0, #f48fb1);
    position: relative;
    transition: all 0.3s ease;
    border: 2px solid rgba(255, 255, 255, 0.5);
    overflow: hidden;
    cursor: pointer;
    min-height: 120px; /* Revert to original min-height for non-bonus items */
  }

  .shop-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
    z-index: 0;
  }

  .shop-item.can-afford {
    filter: blur(0);
    transform: translateY(0);
    box-shadow: 0 6px 15px rgba(233, 30, 99, 0.3);
  }

  .shop-item:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  }

  .shop-item.can-afford:hover {
    box-shadow: 0 12px 25px rgba(233, 30, 99, 0.4);
    transform: translateY(-5px) scale(1.03);
  }

  .shop-item strong {
    display: block;
    margin-bottom: 10px;
    font-size: 1.4rem;
    color: #c2185b;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  .shop-item .item-text {
    color: #5d4037;
    margin-bottom: 8px;
    font-size: 1.1rem;
  }

  .shop-item button {
    margin-top: 12px;
    background: linear-gradient(to bottom, #e91e63, #c2185b);
    color: white;
    font-weight: bold;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    font-size: 1.1rem;
  }

  .shop-item button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  }

  .shop-item button:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .upgrade-count {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #c2185b;
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }

  /* --- Overlays --- */
  .overlay {
    display:none; 
    position:fixed; 
    top:0; 
    left:0; 
    width:100%; 
    height:100%;
    background:rgba(255, 255, 255, 0.95); 
    z-index:1000; 
    padding:60px 20px 20px; 
    overflow-y:auto; 
    box-sizing:border-box; 
    transition: opacity 0.3s;
    backdrop-filter: blur(5px);
  }
  
  .overlay h2 { 
    margin-bottom:30px; 
    color: #c2185b;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  }
  
  /* --- Progress --- */
  #progressOverlay textarea { 
    width:90%; 
    height:150px; 
    margin-top:10px; 
    font-family: monospace; 
    font-size:14px; 
    resize:none; 
    border-radius: 10px;
    border: 2px solid #f8bbd0;
    padding: 10px;
  }
  #progressOverlay input { 
    width:90%; 
    padding:12px; 
    font-size:16px; 
    margin-top:10px; 
    border-radius: 10px;
    border: 2px solid #f8bbd0;
    background: white;
  }
  #progressOverlay button { 
    margin-top:15px; 
    padding:12px 24px; 
    border-radius:10px; 
    border:none; 
    cursor:pointer; 
    font-size:16px; 
    background: linear-gradient(to right, #c2185b, #e91e63);
    color: white;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }

  /* --- Settings --- */
  #settingsOverlay label, #settingsOverlay select, #settingsOverlay input, #settingsOverlay button { 
    font-size:18px; 
    display: block;
    margin-bottom: 15px;
  }
  #settingsOverlay select, #settingsOverlay input[type="range"] { 
    margin-top:10px; 
    padding:10px 15px; 
    border-radius:10px; 
    border:2px solid #880e4f; 
    background:white; 
    cursor:pointer; 
    width: 100%;
  }
  #settingsOverlay label { 
    display:block; 
    margin-top:16px; 
    font-weight: bold;
    color: #880e4f;
  }
  #settingsOverlay input[type="checkbox"] { 
    margin-left:10px; 
    margin-right:6px; 
    transform: scale(1.3);
  }
  #settingsOverlay .setting-row { 
    margin-bottom:20px; 
    padding: 15px;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  }
  #settingsOverlay .setting-title { 
    font-weight:bold; 
    display:inline-block; 
    width:180px; 
    text-align:left; 
    color: #880e4f;
  }

  /* --- Achievements --- */
  #achievementsList { 
    display:flex; 
    flex-wrap:wrap; 
    justify-content:center; 
    gap:20px; 
    max-width:700px; 
    margin:0 auto; 
  }
  .achievement-card {
    display:flex; 
    align-items:center; 
    gap:15px; 
    width:320px; 
    min-width:320px; 
    max-width:320px; 
    min-height:80px; 
    max-height:80px;
    padding:20px 25px; 
    margin:10px 0; 
    border-radius:18px; 
    box-shadow:0 5px 15px rgba(140,0,70,0.15); 
    font-size:18px; 
    font-weight:600;
    transition: all 0.3s ease;
    border: 2px solid #f8bbd0;
    opacity:0.95;
    position:relative;
    box-sizing:border-box;
    background: linear-gradient(145deg, #f8bbd0, #f48fb1);
    overflow: hidden;
  }
  
  .achievement-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
    z-index: 0;
  }
  
  .achievement-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 12px 25px rgba(180,40,130,0.2);
    opacity:1;
    z-index: 2;
  }
  
  .achievement-card.locked { 
    opacity:0.7; 
    filter: grayscale(100%);
  }
  
  .achievement-card.achieved {
    background: linear-gradient(145deg, #a5d6a7, #81c784);
    border-color: #4caf50;
  }
  
  .achievement-icon { 
    font-size:2.2em; 
    margin-right:10px; 
    filter: drop-shadow(0 1px 1px #fff5); 
    text-shadow:0 2px 10px #fff8; 
    width:45px; 
    text-align:center; 
  }

  /* --- Breeds --- */
  .breed-select-btn { 
    padding:10px 25px; 
    border-radius:15px; 
    border:none; 
    margin:12px 10px 0 10px; 
    font-size:18px; 
    font-weight:bold; 
    cursor:pointer; 
    transition: all 0.2s;
    background: linear-gradient(to right, #c2185b, #e91e63);
    color: white;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
  
  .breed-select-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
  }
  
  .breed-select-btn.selected {
    background: linear-gradient(to right, #4caf50, #81c784);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
  
  .breed-lock { 
    color:#aaa; 
    font-size:20px; 
    margin-left:6px; 
    vertical-align:middle; 
  }
  
  .breed-event-tag { 
    background:#ff5252; 
    color:white; 
    padding:4px 10px; 
    border-radius:15px; 
    font-size:13px; 
    margin-left:10px; 
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }

  /* --- Mystery Kitten --- */
  #mysteryKittenBtn { 
    display:none; 
    margin:25px 0 0 0; 
    padding:16px 38px; 
    font-size:22px; 
    border:none; 
    border-radius:15px; 
    font-weight:bold; 
    cursor:pointer; 
    transition: all 0.3s;
    background: linear-gradient(to right, #ff9800, #ffc107);
    color: #5d4037;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    animation: pulseGlow 2s infinite;
  }
  
  @keyframes pulseGlow {
    0% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(255, 152, 0, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0); }
  }

  #mysteryKittenBtn:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  /* --- Prestige --- */
  #prestigeOverlay {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 380px;
    background: rgba(255, 255, 255, 0.98);
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    padding: 30px;
    z-index: 1001;
    display: none;
    text-align: center;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.5);
  }
  
  #prestigeOverlay.active {
    display: block;
  }
  
  #prestigeOverlay h2 {
    margin-top: 0;
    color: #c2185b;
    font-size: 2.2rem;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  }
  
  #prestigeInfo {
    margin: 25px 0;
    padding: 20px;
    background: linear-gradient(145deg, #f8bbd0, #f48fb1);
    border-radius: 15px;
    font-size: 1.2rem;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.5);
  }
  
  #prestigeButton {
    background: linear-gradient(to bottom, #c2185b, #880e4f);
    color: white;
    font-weight: bold;
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-size: 22px;
    margin: 25px 0;
    transition: all 0.3s;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    width: 100%;
  }
  
  #prestigeButton:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }
  
  #prestigeButton:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
  
  .prestige-bonus {
    background: linear-gradient(to right, #e91e63, #c2185b);
    color: white;
    padding: 12px 18px;
    border-radius: 10px;
    margin: 12px 0;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  /* --- Themes --- */
  body.theme-pink { background: linear-gradient(135deg, #f8bbd0, #e1bee7); color: #880e4f; }
  body.theme-blue { background: linear-gradient(135deg, #bbdefb, #90caf9); color: #1565c0; }
  body.theme-dark { background: linear-gradient(135deg, #121212, #424242); color: #bb86fc; }
  body.theme-mint { background: linear-gradient(135deg, #e0f2f1, #b2dfdb); color: #00796b; }
  body.theme-orange { background: linear-gradient(135deg, #ffe0b2, #ffcc80); color: #e65100; }

  /* --- Responsive --- */
  @media (max-width:600px){
    #achievementsList { 
      flex-direction:column; 
      align-items:center; 
    }
    .achievement-card { 
      min-width:0; 
      width:98%; 
      max-width:99vw; 
    }
    img#kitten { 
      width:80%; 
      max-width:300px; 
    }
    #shopOverlay {
      padding: 50px 15px 15px;
    }
    
    #shopOverlay .shop-content {
      max-width: 100%;
    }
    #prestigeOverlay {
      width: 90%;
      left: 5%;
      transform: translateY(-50%);
    }
    
    h1 { font-size: 2.2rem; }
    #score { font-size: 1.5rem; }
    #stats { font-size: 1rem; }
    
    /* Mobile-specific improvements */
    .top-buttons {
      top: 10px;
      right: 10px;
      gap: 8px;
    }
    
    .top-buttons button {
      padding: 10px 16px;
      font-size: 14px;
    }
    
    .shop-item {
      padding: 15px;
    }
    
    .shop-item strong {
      font-size: 1.2rem;
    }
    
    .shop-item .item-text {
      font-size: 1rem;
    }
    
    .shop-item button {
      padding: 8px 15px;
      font-size: 1rem;
    }
    
    .upgrade-count {
      width: 26px;
      height: 26px;
      font-size: 12px;
    }
    
    .shop-tab {
      padding: 8px 16px;
      font-size: 14px;
    }
    
    .shop-header h2 {
      font-size: 1.5rem;
    }
    
    #mysteryKittenBtn {
      padding: 14px 32px;
      font-size: 20px;
    }
    
    .closeOverlay {
      width: 28px;
      height: 28px;
      font-size: 18px;
    }
    
    #footer {
      font-size: 12px;
      bottom: 5px;
      left: 5px;
      padding: 5px 10px;
    }
  }

  /* --- Footer --- */
  #footer { 
    position:fixed; 
    bottom:15px; 
    left:15px; 
    font-size:13px; 
    color:#880e4f; 
    background: rgba(255, 255, 255, 0.7);
    padding: 8px 15px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }
  #footer a { 
    color:#880e4f; 
    text-decoration:none; 
  }
  #footer a:hover { 
    text-decoration:underline; 
  }
  
  /* --- Enhanced blur effect based on proximity --- */
  .proximity-blur {
    filter: blur(5px);
    transition: filter 0.5s ease;
  }
  
  .proximity-blur.visible {
    filter: blur(0);
  }
  
  .proximity-blur .item-text {
    filter: blur(3px);
    transition: filter 0.5s ease;
  }
  
  .proximity-blur.visible .item-text {
    filter: blur(0);
  }
  
  .proximity-blur .item-cost {
    filter: blur(2px);
    transition: filter 0.5s ease;
  }
  
  .proximity-blur.visible .item-cost {
    filter: blur(0);
  }
  
  /* --- Improved shop layout --- */
  #shopOverlay {
    max-height: 80vh;
    overflow-y: auto;
  }
  
  .shop-item {
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  
  .shop-item-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  
  .shop-item-content .item-text {
    margin-bottom: 8px;
  }
  
  .shop-item-content .item-cost {
    margin-top: auto;
  }
  
  /* --- Better visibility for unlocked items --- */
  .shop-item.can-afford {
    filter: blur(0) brightness(1.05);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    border: 2px solid #c2185b;
  }
  
  .shop-item.can-afford:hover {
    box-shadow: 0 10px 25px rgba(233, 30, 99, 0.4);
    border: 2px solid #e91e63;
  }
  
  /* --- Floating Score Animation --- */
  .floating-score {
    position: absolute;
    font-weight: bold;
    font-size: 22px;
    z-index: 2000;
    pointer-events: none;
    animation: floatUp 1.5s ease-out forwards;
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
  }
  
  @keyframes floatUp {
    0% {
      opacity: 1;
      transform: translateY(0) translateX(-50%);
    }
    100% {
      opacity: 0;
      transform: translateY(-100px) translateX(-50%);
    }
  }
  
  /* --- Open Shop Button (now in top-buttons) --- */
  
  /* --- Additive upgrade effects --- */
  .shop-item {
    transition: all 0.3s ease;
  }
  
  .shop-item:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }
  
  .shop-item.can-afford:hover {
    box-shadow: 0 12px 25px rgba(233, 30, 99, 0.4);
  }
  
  .shop-item.can-afford {
    filter: blur(0) brightness(1.05);
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    border: 2px solid #c2185b;
  }
  
  .shop-item.can-afford:hover {
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    border: 2px solid #e91e63;
  }
  
  /* --- Notification Animation --- */
  .notification {
    position: fixed;
    top: 90px;
    left: 50%;
    transform: translateX(-50%);
    background: #c2185b;
    color: white;
    padding: 15px 30px;
    border-radius: 12px;
    z-index: 2000;
    opacity: 0;
    animation: fadeInOut 3s ease forwards;
    box-shadow: 0 6px 15px rgba(0,0,0,0.3);
    font-weight: bold;
    text-align: center;
    max-width: 90%;
  }
  
  @keyframes fadeInOut {
    0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
    10% { opacity: 1; transform: translateX(-50%) translateY(0); }
    90% { opacity: 1; transform: translateX(-50%) translateY(0); }
    100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
  }


  /* New styles for bonus shop items */
  .bonus-shop-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 180px; /* Increased height for image + details */
    padding: 15px; /* Adjust padding for image */
  }

  .bonus-item-image {
    width: 80px;
    height: 80px;
    object-fit: contain;
    margin-bottom: 10px; /* Space between image and details placeholder */
    transition: transform 0.3s ease, opacity 0.3s ease;
    filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2));
    z-index: 2; /* Ensure image is above details when not hovered */
  }

  .bonus-shop-item:hover .bonus-item-image {
    transform: translateY(-100%); /* Move image up and out */
    opacity: 0;
  }

  .bonus-item-details {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 15px;
    box-sizing: border-box;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    opacity: 0;
    transform: translateY(100%); /* Start from bottom, hidden */
    transition: opacity 0.3s ease, transform 0.3s ease;
    color: #5d4037;
    text-align: center;
    z-index: 1; /* Ensure details are below image initially, but come up on hover */
  }

  .bonus-shop-item:hover .bonus-item-details {
    opacity: 1;
    transform: translateY(0);
  }

  .bonus-item-details .item-title {
    font-size: 1.4rem;
    color: #c2185b;
    margin-bottom: 5px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  .bonus-item-details .item-description {
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: #5d4037;
  }

  .bonus-item-details .item-cost-display {
    font-size: 1.1rem;
    font-weight: bold;
    color: #880e4f;
    margin-bottom: 15px;
  }

  .bonus-item-details button {
    margin-top: 0;
    width: 80%;
    padding: 8px 15px;
    font-size: 1rem;
    background: linear-gradient(to bottom, #e91e63, #c2185b);
    color: white;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  .bonus-item-details button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  }

  .bonus-item-details button:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .bonus-shop-item .upgrade-count {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #c2185b;
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    z-index: 3; /* Ensure it's on top of everything */
  }

  </style>
</head>
<body class="theme-pink">
<audio id="clickSound" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa6e3e.mp3" preload="auto"></audio>
<audio id="meowSound" src="sounds/cat-meow.mp3" preload="auto"></audio>
<h1>Kitten Clicker</h1>
<p id="score">Kittens: 0</p>
<p id="stats">Click Value: <span id="clickValue">1</span> | CPS: <span id="autoClickers">0</span></p>
<img id="kitten" src="https://cdn.pixabay.com/photo/2017/11/09/21/41/american-shorthair-2934720_1280.jpg" alt="American Shorthair Kitten" />
<button id="mysteryKittenBtn">üêæ Mystery Kitten</button>
<div id="comboMeter">Combo x1.0</div>
<div id="goldenKittenEl">üê±‚ú®</div>

<!-- Open Shop Button (hidden, now using top-buttons) -->
<button id="openShopBtn" style="display: none;">üõí Shop</button>

<!-- Auth Button (hidden - authentication no longer required) -->
 

<!-- Prestige Overlay -->
<div id="prestigeOverlay">
  <h2>Prestige</h2>
  <div id="prestigeInfo">
    <p>Reset your progress for permanent bonuses!</p>
    <p>Current Prestige Level: <span id="prestigeLevel">0</span></p>
    <p>Required Kittens: <span id="prestigeRequirement">1000000</span></p>
  </div>
  <div id="prestigeBonuses">
    <div class="prestige-bonus">+10% Click Value</div>
    <div class="prestige-bonus">+5% CPS</div>
    <div class="prestige-bonus">+20% Score Multiplier</div>
  </div>
  <button id="prestigeButton">Prestige Now!</button>
  <button class="closeOverlay" onclick="closeOverlay('prestigeOverlay')">√ó</button>
</div>

<!-- Shop Overlay -->
<div id="shopOverlay" class="overlay">
  <button class="closeOverlay" onclick="closeOverlay('shopOverlay')">√ó</button>
  <div class="shop-header">
    <h2>Kitten Shop</h2>
  </div>
  
  <div class="shop-tabs">
    <div class="shop-tab active" id="tabClickValue" onclick="showShopTab('clickValue')">Click Value</div>
    <div class="shop-tab" id="tabAuto" onclick="showShopTab('auto')">Auto Upgrades</div>
    <div class="shop-tab" id="tabBonus" onclick="showShopTab('bonus')">Bonus Upgrades</div>
    <div class="shop-tab" id="tabOffline" onclick="showShopTab('offline')">Offline Upgrades</div>
    <div class="shop-tab" id="tabBundles" onclick="showShopTab('bundles')">Bundles</div>
  </div>
  
  <div id="shopContent" class="shop-content">
    <div id="clickValueContent" class="shop-tab-content active">
      <div class="shop-item" onclick="buyUpgrade('milkBowl', 0.5)"><div class="shop-item-content"><strong class="item-text">Milk Bowl</strong><br /><span class="item-text"> +0.5 click value</span><br />
        <button id="milkBowlBtn">Buy for <span class="item-cost" id="milkBowlCost">25</span></button>
        <div class="upgrade-count" id="milkBowlCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyUpgrade('catFood', 2)"><div class="shop-item-content"><strong class="item-text">Cat Food</strong><br /><span class="item-text"> +2 click value</span><br />
        <button id="catFoodBtn">Buy for <span class="item-cost" id="catFoodCost">115</span></button>
        <div class="upgrade-count" id="catFoodCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyUpgrade('scratcher', 7)"><div class="shop-item-content"><strong class="item-text">Scratcher</strong><br /><span class="item-text"> +7 click value</span><br />
        <button id="scratcherBtn">Buy for <span class="item-cost" id="scratcherCost">700</span></button>
        <div class="upgrade-count" id="scratcherCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyUpgrade('kittenFactory', 15)"><div class="shop-item-content"><strong class="item-text">Kitten Factory</strong><br /><span class="item-text"> +15 click value</span><br />
        <button id="kittenFactoryBtn">Buy for <span class="item-cost" id="kittenFactoryCost">5000</span></button>
        <div class="upgrade-count" id="kittenFactoryCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyUpgrade('cityOfKittens', 30)"><div class="shop-item-content"><strong class="item-text">City of Kittens</strong><br /><span class="item-text"> +30 click value</span><br />
        <button id="cityOfKittensBtn">Buy for <span class="item-cost" id="cityOfKittensCost">30000</span></button>
        <div class="upgrade-count" id="cityOfKittensCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyUpgrade('worldOfMeows', 80)"><div class="shop-item-content"><strong class="item-text">A World of Meows</strong><br /><span class="item-text"> +80 click value</span><br />
        <button id="worldOfMeowsBtn">Buy for <span class="item-cost" id="worldOfMeowsCost">200000</span></button>
        <div class="upgrade-count" id="worldOfMeowsCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyUpgrade('goldKitty', 150)"><div class="shop-item-content"><strong class="item-text">Gold Kitty</strong><br /><span class="item-text"> +150 click value</span><br />
        <button id="goldKittyBtn">Buy for <span class="item-cost" id="goldKittyCost">15000000</span></button>
        <div class="upgrade-count" id="goldKittyCount">0</div>
      </div></div>
    </div>
    
    <div id="autoContent" class="shop-tab-content">
      <div class="shop-item" onclick="buyAutoClicker()"><div class="shop-item-content"><strong class="item-text">Auto-Mouse</strong><br /><span class="item-text"> +5 CPS</span><br />
        <button id="autoClickerBtn">Buy for <span class="item-cost" id="autoClickerCost">2000</span></button>
        <div class="upgrade-count" id="autoClickerCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyAutoKittenFarm()"><div class="shop-item-content"><strong class="item-text">Auto-Kitten Farm</strong><br /><span class="item-text"> +7 CPS</span><br />
        <button id="autoKittenFarmBtn">Buy for <span class="item-cost" id="autoKittenFarmCost">15000</span></button>
        <div class="upgrade-count" id="autoKittenFarmCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyKittenPlanet()"><div class="shop-item-content"><strong class="item-text">Kitten Planet</strong><br /><span class="item-text"> +30 CPS</span><br />
        <button id="kittenPlanetBtn">Buy for <span class="item-cost" id="kittenPlanetCost">1000000</span></button>
        <div class="upgrade-count" id="kittenPlanetCount">0</div>
      </div></div>
      <div id="dynamicAutoContainer"></div>
    </div>
    
    <div id="bonusContent" class="shop-tab-content">
      <div class="shop-item bonus-shop-item" onclick="buyBonusUpgrade('speedBoost', 0.05)">
        <img src="https://cdn.pixabay.com/photo/2016/03/31/19/52/lightning-1295982_1280.png" alt="Speed Boost" class="bonus-item-image">
        <div class="bonus-item-details">
          <strong class="item-title">Speed Boost</strong>
          <span class="item-description">Increases click value by 5%</span>
          <span class="item-cost-display">Cost: <span class="item-cost" id="speedBoostCost">5000</span> Kittens</span>
          <button id="speedBoostBtn">Buy</button>
        </div>
        <div class="upgrade-count" id="speedBoostCount">0</div>
      </div>
      <div class="shop-item bonus-shop-item" onclick="buyBonusUpgrade('doublePoints', 0.1)">
        <img src="https://cdn.pixabay.com/photo/2013/07/12/17/36/star-152438_1280.png" alt="Double Points" class="bonus-item-image">
        <div class="bonus-item-details">
          <strong class="item-title">Double Points</strong>
          <span class="item-description">Increases score multiplier by 10%</span>
          <span class="item-cost-display">Cost: <span class="item-cost" id="doublePointsCost">15000</span> Kittens</span>
          <button id="doublePointsBtn">Buy</button>
        </div>
        <div class="upgrade-count" id="doublePointsCount">0</div>
      </div>
      <div class="shop-item bonus-shop-item" onclick="buyBonusUpgrade('goldenPaws', 0.2)">
        <img src="https://cdn.pixabay.com/photo/2017/02/01/10/21/paw-2029013_1280.png" alt="Golden Paws" class="bonus-item-image">
        <div class="bonus-item-details">
          <strong class="item-title">Golden Paws</strong>
          <span class="item-description">Increases CPS by 20%</span>
          <span class="item-cost-display">Cost: <span class="item-cost" id="goldenPawsCost">50000</span> Kittens</span>
          <button id="goldenPawsBtn">Buy</button>
        </div>
        <div class="upgrade-count" id="goldenPawsCount">0</div>
      </div>
    </div>
    <div id="offlineContent" class="shop-tab-content">
      <div class="shop-item" onclick="buyOfflineClick()"><div class="shop-item-content"><strong class="item-text">Idle Paws</strong><br /><span class="item-text"> +1 offline click/sec</span><br />
        <button id="offlineClickBtn">Buy for <span class="item-cost" id="offlineClickCost">5000</span></button>
        <div class="upgrade-count" id="offlineClickCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyOfflineEfficiency()"><div class="shop-item-content"><strong class="item-text">Efficiency Training</strong><br /><span class="item-text"> +3% offline bonus</span><br />
        <button id="offlineEfficiencyBtn">Buy for <span class="item-cost" id="offlineEfficiencyCost">250000</span></button>
        <div class="upgrade-count" id="offlineEfficiencyCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyOfflineHibernate()"><div class="shop-item-content"><strong class="item-text">Hibernate Mode</strong><br /><span class="item-text"> +0.2 offline click/sec</span><br />
        <button id="offlineHibernateBtn">Buy for <span class="item-cost" id="offlineHibernateCost">500000</span></button>
        <div class="upgrade-count" id="offlineHibernateCount">0</div>
      </div></div>
      <div class="shop-item" onclick="buyOfflineTimeCapsule()"><div class="shop-item-content"><strong class="item-text">Time Capsule</strong><br /><span class="item-text"> +10% offline bonus</span><br />
        <button id="offlineTimeCapsuleBtn">Buy for <span class="item-cost" id="offlineTimeCapsuleCost">1000000</span></button>
        <div class="upgrade-count" id="offlineTimeCapsuleCount">0</div>
      </div></div>
    </div>
    <div id="bundlesContent" class="shop-tab-content">
      <div id="bundlesContainer"></div>
    </div>
  </div>
</div>

<div class="top-buttons">
  <button onclick="openOverlay('shopOverlay')"><i class="fas fa-shopping-cart"></i> Shop</button>
  <button onclick="openOverlay('progressOverlay')"><i class="fas fa-save"></i> Progress</button>
  <button onclick="openOverlay('settingsOverlay')"><i class="fas fa-cog"></i> Settings</button>
  <button onclick="openOverlay('achievementsOverlay')"><i class="fas fa-trophy"></i> Achievements</button>
  <button onclick="openOverlay('breedsOverlay')"><i class="fas fa-paw"></i> Breeds</button>
  <button onclick="openOverlay('prestigeOverlay')"><i class="fas fa-star"></i> Prestige</button>
</div>

<!-- Footer with player count and version -->
<div id="footer">
  <div>Players: <span id="currentPlayers">Loading...</span> | Total: <span id="totalPlayers">Loading...</span></div>
  <div>Version: V1.41 | <a href="https://kittenclicker.vercel.app//fangdootle/about.html" target="_blank">About</a></div>
</div>

<!-- Progress Overlay -->
<div id="progressOverlay" class="overlay">
  <button class="closeOverlay" onclick="closeOverlay('progressOverlay')">√ó</button>
  <h2>Save / Load Progress</h2>
  <button onclick="exportSave()">Get Save Code</button><br />
  <textarea id="saveCodeBox" readonly placeholder="Your save code will appear here after clicking 'Get Save Code'"></textarea><br />
  <input type="text" id="loadSaveCode" placeholder="Paste your save code here" />
  <button onclick="loadSave()">Load Save Code</button>
</div>

<!-- Settings Overlay -->
<div id="settingsOverlay" class="overlay">
  <button class="closeOverlay" onclick="closeOverlay('settingsOverlay')">√ó</button>
  <h2>Settings</h2>
  <div class="setting-row">
    <label for="themeSelect"><span class="setting-title">Color Theme:</span></label>
    <select id="themeSelect">
      <option value="pink" selected>Pink</option>
      <option value="blue">Blue</option>
      <option value="dark">Dark</option>
      <option value="mint">Mint</option>
      <option value="orange">Orange</option>
    </select>
  </div>
  <div class="setting-row">
    <label><span class="setting-title">Floating Scores:</span>
      <input type="checkbox" id="floatScoreToggle" checked>
      Show
    </label>
  </div>
  <div class="setting-row">
    <label for="notifVolume"><span class="setting-title">Notification Volume:</span></label>
    <input type="range" min="0" max="1" step="0.01" id="notifVolume" value="1">
  </div>
  <div class="setting-row">
    <label><span class="setting-title">Disable Animations:</span>
      <input type="checkbox" id="disableAnimations">
    </label>
  </div>
  <div class="setting-row">
    <label><span class="setting-title">Console:</span></label>
    <input type="text" id="consoleInput" placeholder="Type 'qwertycps=number' or 'qwertycv=number'" style="display:none;">
    <button onclick="executeConsoleCommand()" id="consoleButton" style="display:none;">Execute</button>
    <div id="consoleOutput" style="margin-top:10px; font-family:monospace; max-height:150px; overflow-y:auto;"></div>
  </div>
  <div class="setting-row">
    <button onclick="resetProgress()" style="background:#b71c1c;color:#fff;">Reset Progress</button>
  </div>
</div>

<!-- Achievements Overlay -->
<div id="achievementsOverlay" class="overlay">
  <button class="closeOverlay" onclick="closeOverlay('achievementsOverlay')">√ó</button>
  <h2>Achievements</h2>
  <div id="achievementsList"></div>
</div>

<!-- Breeds Overlay -->
<div id="breedsOverlay" class="overlay">
  <button class="closeOverlay" onclick="closeOverlay('breedsOverlay')">√ó</button>
  <h2>Cat Breeds</h2>
  <div class="shop-tabs">
    <div class="shop-tab active" id="tabBreeds" onclick="showBreedsTab('breeds')">Breeds</div>
    <div class="shop-tab" id="tabEvents" onclick="showBreedsTab('events')">Events</div>
    <div class="shop-tab" id="tabFusion" onclick="showBreedsTab('fusion')">Breed Fusion</div>
  </div>
  <div id="breedsContent" class="shop-content">
    <div id="breedsList"></div>
  </div>
  <div id="eventsContent" class="shop-content" style="display:none;">
    <!-- Halloween cat section removed -->
  </div>
  <div id="fusionContent" class="shop-content" style="display:none;">
    <div style="margin:12px 0;">
      <select id="fusionBreedA"></select>
      <select id="fusionBreedB"></select>
      <button id="fuseButton" onclick="fuseBreeds()">Fuse</button>
    </div>
    <div id="fusionResult" style="margin-top:8px;"></div>
  </div>
</div>

<!-- Auth Overlay -->
 

<script>
let userId = '';
let sessionId = '';

// Generate or retrieve session ID for player tracking
function getSessionId() {
  if (!sessionId) {
    // Try to get from localStorage first
    sessionId = localStorage.getItem('kittenSessionId');
    if (!sessionId) {
      // Generate a new session ID
      sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('kittenSessionId', sessionId);
    }
  }
  return sessionId;
}

// Get user ID for tracking (use userId if authenticated, otherwise use sessionId)
function getTrackingId() {
  return userId || getSessionId();
}

// Game state variables (existing code remains unchanged)
let kittens = 0, clickValue = 1;
let upgrades = {milkBowl:0,catFood:0,scratcher:0,kittenFactory:0,cityOfKittens:0,worldOfMeows:0,autoClicker:0,autoKittenFarm:0,kittenPlanet:0,goldKitty:0,nebulaCursor:0,starForge:0};
let upgradeCosts = {milkBowl:50,catFood:200,scratcher:800,kittenFactory:5000,cityOfKittens:25000,worldOfMeows:100000,autoClicker:500,autoKittenFarm:2500,kittenPlanet:1000000,goldKitty:2000000,nebulaCursor:750000,starForge:5000000};
let selectedBreed = "american_shorthair";
let breedsUnlocked = {
    american_shorthair: true, 
    maine_coon: false, 
    siamese: false,
    himalayan: false,
    halloween_cat: false,
    christmas_kitten: false,
    ragdoll: false,
    persian: false,
    bengal: false,
    cosmic_maine: false,
    mythic_chimera: false,
    wild_ragdoll: false
};
let breedImages = {
    american_shorthair: "https://cdn.pixabay.com/photo/2017/11/09/21/41/american-shorthair-2934720_1280.jpg",
    maine_coon: "https://cdn.pixabay.com/photo/2021/12/17/19/15/pet-6877246_1280.jpg",
    siamese: "https://cdn.pixabay.com/photo/2017/02/15/12/12/cat-2068462_1280.jpg",
    himalayan: "https://cdn.pixabay.com/photo/2016/03/24/21/21/cat-1277665_1280.jpg",
    halloween_cat: "https://cdn.pixabay.com/photo/2022/08/06/15/46/halloween-7368864_1280.jpg",
    christmas_kitten: "https://cdn.pixabay.com/photo/2016/12/11/02/32/cat-1898638_1280.jpg",
    ragdoll: "https://cdn.pixabay.com/photo/2018/06/28/14/12/cat-3504008_1280.jpg",
    persian: "https://cdn.pixabay.com/photo/2017/01/21/08/19/cat-1996569_1280.jpg",
    bengal: "https://cdn.pixabay.com/photo/2022/11/17/17/46/cat-7598590_1280.jpg",
    cosmic_maine: "https://cdn.pixabay.com/photo/2016/11/19/13/20/cat-1835897_1280.jpg",
    mythic_chimera: "https://cdn.pixabay.com/photo/2017/02/20/18/03/cat-2083492_1280.jpg",
    wild_ragdoll: "https://cdn.pixabay.com/photo/2017/08/07/16/13/cat-2601183_1280.jpg"
};
let breedNames = {
    american_shorthair: "American Shorthair",
    maine_coon: "Maine Coon",
    siamese: "Siamese",
    himalayan: "Himalayan",
    halloween_cat: "Halloween Cat",
    christmas_kitten: "Christmas Kitten",
    ragdoll: "Ragdoll",
    persian: "Persian",
    bengal: "Bengal",
    cosmic_maine: "Cosmic Maine",
    mythic_chimera: "Mythic Chimera",
    wild_ragdoll: "Wild Ragdoll"
};
let extraCPSBreed = {
    american_shorthair: 0,
    maine_coon: 10,
    siamese: 50,
    himalayan: 25,
    halloween_cat: 200,
    christmas_kitten: 250,
    ragdoll: 40,
    persian: 35,
    bengal: 60,
    cosmic_maine: 300,
    mythic_chimera: 500,
    wild_ragdoll: 180
};
let fusionRecipes = {
  "maine_coon|siamese": "cosmic_maine",
  "himalayan|persian": "mythic_chimera",
  "ragdoll|bengal": "wild_ragdoll"
};
  let achievementsData = [
    // Early game / tutorial
    { id: 'click1', text: 'CLICK: Click the kitten!', achieved: false, condition: () => kittens > 0 },
    { id: 'milkBowl1', text: 'You have to start somewhere: Buy your first Milk Bowl', achieved: false, condition: () => upgrades.milkBowl >= 1 },
    { id: 'score100', text: 'Kittens: 100 points', achieved: false, condition: () => kittens >= 100 },
    { id: 'score1000', text: 'Kittens: 1000 points', achieved: false, condition: () => kittens >= 1000 },
    { id: 'click10', text: 'Get 10 click value', achieved: false, condition: () => clickValue >= 10 },
    { id: 'auto1', text: 'Buy your first Auto-Mouse', achieved: false, condition: () => upgrades.autoClicker >= 1 },
    { id: 'truepower', text: 'True Power: Select a new kitten breed!', achieved: false, condition: () => selectedBreed !== "American Shorthair" },
    { id: 'tenk', text: '10k: Get 10000 kittens!', achieved: false, condition: () => kittens >= 10000 },
    { id: 'mystery1', text: 'Take a chance: Try the Mystery Kitten!', achieved: false, condition: () => window.usedMysteryKitten },

    // Score / grind based
    { id: 'click100k', text: 'Dedicated Paw-sion: Reach 100,000 kittens!', achieved: false, condition: () => kittens >= 100000 },
    { id: 'million_paw', text: 'Million Paw | 1,000,000 kittens', achieved: false, condition: () => kittens >= 1000000 },
    { id: 'score1B', text: 'Kittens: 1B points', achieved: false, condition: () => kittens >= 1000000000 },

    // Auto-click / CPS focused
    { id: 'auto10', text: 'Auto Fan: Buy 10 Auto-Mouses', achieved: false, condition: () => upgrades.autoClicker >= 10 },
    { id: 'auto20', text: 'Auto Master: Buy 20 Auto-Mouses', achieved: false, condition: () => upgrades.autoClicker >= 20 },
    { id: 'cps50', text: 'Rain of Paws | Reach 50 CPS', achieved: false, condition: () => (upgrades.autoClicker * 5 + upgrades.autoKittenFarm * 7 + upgrades.kittenPlanet * 30 + (extraCPSBreed[selectedBreed] || 0)) >= 50 },
    { id: 'cps500', text: 'Storm of Paws | Reach 500 CPS', achieved: false, condition: () => (upgrades.autoClicker * 5 + upgrades.autoKittenFarm * 7 + upgrades.kittenPlanet * 30 + (extraCPSBreed[selectedBreed] || 0)) >= 500 },

    // Shop / upgrades
    { id: 'double_trouble', text: 'Double Trouble | Own 2 different upgrades', achieved: false, condition: () => Object.values(upgrades).filter(u => u > 0).length >= 2 },
    { id: 'shop_enthusiast', text: 'Shop Enthusiast | Buy 10 total upgrades', achieved: false, condition: () => Object.values(upgrades).reduce((a, b) => a + b, 0) >= 10 },
    { id: 'luxury_cat', text: 'Luxury Cat | Buy 100 total upgrades', achieved: false, condition: () => Object.values(upgrades).reduce((a, b) => a + b, 0) >= 100 },

    // Breeds / collection
    { id: 'halloween_unlock', text: 'Spooky Surprise: Unlock the Halloween Cat!', achieved: false, condition: () => breedsUnlocked.halloween_cat },
    { id: 'christmas_unlock', text: 'Holiday Cheer: Unlock the Christmas Kitten!', achieved: false, condition: () => breedsUnlocked.christmas_kitten },
    { id: 'kitten_collector', text: 'Kitten Collector | Unlock 5 kittens', achieved: false, condition: () => Object.values(breedsUnlocked).filter(b => b).length >= 5 },
    { id: 'breeder_supreme', text: 'Breeder Supreme | Unlock 10 kittens', achieved: false, condition: () => Object.values(breedsUnlocked).filter(b => b).length >= 10 },

    // Prestige & long-term grind
    { id: 'prestige_beginner', text: 'Prestige Beginner | Prestige once', achieved: false, condition: () => prestigeLevel >= 1 },
    { id: 'prestige_expert', text: 'Prestige Expert | Prestige 10 times', achieved: false, condition: () => prestigeLevel >= 10 },
    { id: 'prestige_legend', text: 'Prestige Legend | Prestige 25 times', achieved: false, condition: () => prestigeLevel >= 25 },

    // Meta-achievements
    { id: 'achievement_hunter', text: 'Achievement Hunter | Unlock 10 achievements', achieved: false, condition: () => achievementsData.filter(a => a.achieved).length >= 10 },
    { id: 'true_purrfection', text: 'True Purrfection | Unlock 50 achievements (action-based only) and give full achievements section', achieved: false, condition: () => achievementsData.filter(a => a.achieved).length >= 50 },

    // Special / rare
    { id: 'rich_kitty', text: 'Rich Kitty | Reach 100,000 kittens in a single run', achieved: false, condition: () => kittens >= 100000 },
    
  ];
achievementsData.push(
  { id: 'cps1k', text: 'Speed Paw | Reach 1,000 CPS', achieved: false, condition: () => (upgrades.autoClicker * 5 + upgrades.autoKittenFarm * 7 + upgrades.kittenPlanet * 30 + (extraCPSBreed[selectedBreed] || 0)) >= 1000 },
  { id: 'cps10k', text: 'Blizzard of Paws | Reach 10,000 CPS', achieved: false, condition: () => (upgrades.autoClicker * 5 + upgrades.autoKittenFarm * 7 + upgrades.kittenPlanet * 30 + (extraCPSBreed[selectedBreed] || 0)) >= 10000 },
  { id: 'score10M', text: 'Ten Million Kittens', achieved: false, condition: () => kittens >= 10000000 },
  { id: 'score100M', text: 'Hundred Million Kittens', achieved: false, condition: () => kittens >= 100000000 },
  { id: 'event_halloween_master', text: 'Halloween Master | Use Halloween Cat with 200 CPS', achieved: false, condition: () => selectedBreed === 'halloween_cat' && (upgrades.autoClicker * 5 + upgrades.autoKittenFarm * 7 + upgrades.kittenPlanet * 30 + (extraCPSBreed[selectedBreed] || 0)) >= 200 },
  { id: 'event_christmas_spirit', text: 'Christmas Spirit | Use Christmas Kitten with 300 CPS', achieved: false, condition: () => selectedBreed === 'christmas_kitten' && (upgrades.autoClicker * 5 + upgrades.autoKittenFarm * 7 + upgrades.kittenPlanet * 30 + (extraCPSBreed[selectedBreed] || 0)) >= 300 },
  { id: 'fusion_first', text: 'Fusion Pioneer | Create your first fused breed', achieved: false, condition: () => breedsUnlocked.cosmic_maine || breedsUnlocked.mythic_chimera || breedsUnlocked.wild_ragdoll }
);
  window.usedMysteryKitten = false;
  window.userHasReviewed = false;

  // Settings State
  let userSettings = {
    theme: "pink",
    floatScore: true,
    notifVolume: 1,
    disableAnimations: false
  };

  // Bonus upgrades data
  let bonusUpgrades = {
    speedBoost: 0,
    doublePoints: 0,
    goldenPaws: 0
  };
  
  let bonusUpgradeCosts = {
    speedBoost: 5000,
    doublePoints: 15000,
    goldenPaws: 50000
  };

  // Prestige system
  let prestigeLevel = 0;
  let prestigeBonuses = {
    clickValue: 0.10,   // +10% click value
    cps: 0.05,         // +5% CPS
    scoreMultiplier: 0.20 // +20% score multiplier
  };

  

  // -- UI elements --
  const scoreEl = document.getElementById('score');
  const clickValueEl = document.getElementById('clickValue');
  const autoClickersEl = document.getElementById('autoClickers');
  const kittenImg = document.getElementById('kitten');
  const clickSound = document.getElementById('clickSound');
  const meowSound = document.getElementById('meowSound');
  const mysteryKittenBtn = document.getElementById('mysteryKittenBtn');
  const shopOverlay = document.getElementById('shopOverlay');
  const prestigeOverlay = document.getElementById('prestigeOverlay');
  const prestigeButton = document.getElementById('prestigeButton');
  const prestigeLevelEl = document.getElementById('prestigeLevel');
  const prestigeRequirementEl = document.getElementById('prestigeRequirement');
  const comboMeterEl = document.getElementById('comboMeter');
  const goldenKittenEl = document.getElementById('goldenKittenEl');

  // Track manual clicks
  let manualClickCount = 0;
  let streakCount = 0;
  let streakTimer = null;
  let criticalChance = 0.03;
  let goldenBoostCPS = 0;
  let goldenBoostTimer = null;

  let offlineClicks = 0;
  let offlineClickCost = 5000;
  let offlineEfficiency = 0;
  let offlineEfficiencyCost = 250000;
  let offlineHibernate = 0;
  let offlineHibernateCost = 500000;
  let offlineTimeCapsule = 0;
  let offlineTimeCapsuleCost = 1000000;
  

  // --- SETTINGS LOGIC ---
  function updateSettingsUI() {
    document.getElementById('themeSelect').value = userSettings.theme;
    document.getElementById('floatScoreToggle').checked = userSettings.floatScore;
    document.getElementById('notifVolume').value = userSettings.notifVolume;
    document.getElementById('disableAnimations').checked = userSettings.disableAnimations;
  }
  
  function applyTheme(theme) {
    document.body.className = '';
    document.body.classList.add('theme-' + theme);
  }

  // --- PRESTIGE LOGIC ---
  function updatePrestigeInfo() {
    prestigeLevelEl.textContent = prestigeLevel;
    const requirement = Math.pow(10, 6 + prestigeLevel);
    prestigeRequirementEl.textContent = requirement.toLocaleString();
    
    // Update prestige bonuses display
    const bonusesContainer = document.getElementById('prestigeBonuses');
    bonusesContainer.innerHTML = `
      <div class="prestige-bonus">+${(prestigeBonuses.clickValue * 100 * (prestigeLevel + 1)).toFixed(0)}% Click Value</div>
      <div class="prestige-bonus">+${(prestigeBonuses.cps * 100 * (prestigeLevel + 1)).toFixed(0)}% CPS</div>
      <div class="prestige-bonus">+$${(prestigeBonuses.scoreMultiplier * 100 * (prestigeLevel + 1)).toFixed(0)}% Score Multiplier</div>
    `;
  }

  // --- ACHIEVEMENTS LOGIC ---
  function renderAchievements() {
    const container = document.getElementById('achievementsList');
    container.innerHTML = '';
    for (const ach of achievementsData) {
      const card = document.createElement('div');
      card.className = 'achievement-card ' + (ach.achieved ? 'achieved' : 'locked');
      card.innerHTML = `<span class="achievement-icon">${ach.achieved ? 'üèÜ' : 'üîí'}</span><span>${ach.text}</span>`;
      container.appendChild(card);
    }
  }

  // --- BREEDS LOGIC ---
  function renderBreeds() {
    const list = document.getElementById('breedsList');
    list.innerHTML = '';
    ["american_shorthair", "maine_coon", "siamese", "himalayan", "ragdoll", "persian", "bengal"].forEach(breed => {
      const div = document.createElement('div');
      div.style.margin = "28px 0 25px 0";
      div.style.padding = "12px";
      div.style.background = "#fff6f6";
      div.style.borderRadius = "12px";
      div.style.boxShadow = "0 2px 12px #f8bbd0";
      div.style.maxWidth = "340px";
      div.style.marginLeft = "auto";
      div.style.marginRight = "auto";

      let label = `<b>${breedNames[breed]}</b>`;

      // Lock logic
      if (!breedsUnlocked[breed]) {
        if (breed === "maine_coon") {
          label += `<span class="breed-lock">üîí (5 achievements required)</span>`;
        } else if (breed === "siamese") {
          label += `<span class="breed-lock">üîí (10 achievements required)</span>`;
        } else if (breed === "himalayan") {
          label += `<span class="breed-lock">üîí (15 achievements required)</span>`;
        } else if (breed === "ragdoll") {
          label += `<span class="breed-lock">üîí (20 achievements required)</span>`;
        } else if (breed === "persian") {
          label += `<span class="breed-lock">üîí (25 achievements required)</span>`;
        } else if (breed === "bengal") {
          label += `<span class="breed-lock">üîí (30 achievements required)</span>`;
        } else if (breed === "cat_of_the_cosmos") {
          label += `<span class="breed-lock">üîí (25 achievements required)</span>`;
        }
      }

      // Bonus text
      let bonusText = "";
      if (breed === "maine_coon") bonusText = "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +10 CPS & +5 Click Value</div>";
      if (breed === "siamese") bonusText = "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +50 CPS & +50 Click Value</div>";
      if (breed === "himalayan") bonusText = "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +25 CPS & +75 Click Value</div>";
      if (breed === "ragdoll") bonusText = "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +40 CPS & +30 Click Value</div>";
      if (breed === "persian") bonusText = "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +35 CPS & +20 Click Value</div>";
      if (breed === "bengal") bonusText = "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +60 CPS & +40 Click Value</div>";
      

      div.innerHTML = `
        <div style="font-size:20px;margin-bottom:8px;">${label}</div>
        <img src="${breedImages[breed]}" alt="${breedNames[breed]}" style="width:120px;border-radius:14px;box-shadow:0 2px 8px #f8bbd0;">
        <div style="margin-top:7px;">
          <button class="breed-select-btn${selectedBreed===breed?" selected":""}"
            onclick="selectBreed('${breed}')">
            ${selectedBreed===breed ? "Selected" : "Select"}
          </button>
        </div>
        ${bonusText}
      `;

      list.appendChild(div);
    });

    // Add Halloween Cat in the events section only (but we'll only show it during Halloween)
    const halloweenDiv = document.createElement('div');
    halloweenDiv.style.margin = "28px 0 25px 0";
    halloweenDiv.style.padding = "12px";
    halloweenDiv.style.background = "#fff6f6";
    halloweenDiv.style.borderRadius = "12px";
    halloweenDiv.style.boxShadow = "0 2px 12px #f8bbd0";
    halloweenDiv.style.maxWidth = "340px";
    halloweenDiv.style.marginLeft = "auto";
    halloweenDiv.style.marginRight = "auto";

    let halloweenLabel = `<b>${breedNames.halloween_cat}</b>`;
    
    // Add event tag for Halloween cat
    const now = new Date();
    const isHalloween = (now.getMonth() === 9 && now.getDate() >= 20 && now.getDate() <= 31) || 
                        (now.getMonth() === 10 && now.getDate() <= 1);
    
    if (isHalloween) {
      halloweenLabel += `<span class="breed-event-tag">EVENT</span>`;
    }

    // Lock logic for Halloween cat
    if (!breedsUnlocked.halloween_cat) {
      if (isHalloween) {
        halloweenLabel += `<span class="breed-lock">üîí (50k kittens & 10 achievements required)</span>`;
      } else {
        halloweenLabel += `<span class="breed-lock">üîí (Only available Oct 20-31)</span>`;
      }
    }

    // Only show Halloween cat during Halloween season
    if (isHalloween) {
      halloweenDiv.innerHTML = `
        <div style="font-size:20px;margin-bottom:8px;">${halloweenLabel}</div>
        <img src="${breedImages.halloween_cat}" alt="${breedNames.halloween_cat}" style="width:120px;border-radius:14px;box-shadow:0 2px 8px #f8bbd0;">
        <div style="margin-top:7px;">
          <button class="breed-select-btn${selectedBreed==='halloween_cat'?" selected":""}"
            onclick="selectBreed('halloween_cat')">
            ${selectedBreed==='halloween_cat' ? "Selected" : "Select"}
          </button>
        </div>
        <div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +200 CPS & +200 Click Value</div>
      `;
      
      // Add to breedsList instead of eventsContent
      list.appendChild(halloweenDiv);
    }

    // Add Christmas Kitten in the events section (Dec 12-31)
    const christmasDiv = document.createElement('div');
    christmasDiv.style.margin = "28px 0 25px 0";
    christmasDiv.style.padding = "12px";
    christmasDiv.style.background = "#fff6f6";
    christmasDiv.style.borderRadius = "12px";
    christmasDiv.style.boxShadow = "0 2px 12px #f8bbd0";
    christmasDiv.style.maxWidth = "340px";
    christmasDiv.style.marginLeft = "auto";
    christmasDiv.style.marginRight = "auto";

    let christmasLabel = `<b>${breedNames.christmas_kitten}</b>`;
    
    // Add event tag for Christmas kitten
    const isChristmas = (now.getMonth() === 11 && now.getDate() >= 1 && now.getDate() <= 31);
    
    if (isChristmas) {
      christmasLabel += `<span class="breed-event-tag">EVENT</span>`;
    }

    // Lock logic for Christmas kitten
    if (!breedsUnlocked.christmas_kitten) {
      if (isChristmas) {
        christmasLabel += `<span class="breed-lock">üîí (100k kittens & 12 achievements required)</span>`;
      } else {
        christmasLabel += `<span class="breed-lock">üîí (Only available Dec 1-31)</span>`;
      }
    }

    // Only show Christmas kitten during Christmas season (or if unlocked)
    if (isChristmas || breedsUnlocked.christmas_kitten) {
      christmasDiv.innerHTML = `
        <div style="font-size:20px;margin-bottom:8px;">${christmasLabel}</div>
        <img src="${breedImages.christmas_kitten}" alt="${breedNames.christmas_kitten}" style="width:120px;border-radius:14px;box-shadow:0 2px 8px #f8bbd0;">
        <div style="margin-top:7px;">
          <button class="breed-select-btn${selectedBreed==='christmas_kitten'?" selected":""}"
            onclick="selectBreed('christmas_kitten')">
            ${selectedBreed==='christmas_kitten' ? "Selected" : "Select"}
          </button>
        </div>
        <div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +250 CPS & +150 Click Value</div>
      `;
      
      // Add to breedsList
      list.appendChild(christmasDiv);
    }

    ["cosmic_maine", "mythic_chimera", "wild_ragdoll"].forEach(fused => {
      if (!breedsUnlocked[fused]) return;
      const div = document.createElement('div');
      div.style.margin = "28px 0 25px 0";
      div.style.padding = "12px";
      div.style.background = "#fff6f6";
      div.style.borderRadius = "12px";
      div.style.boxShadow = "0 2px 12px #f8bbd0";
      div.style.maxWidth = "340px";
      div.style.marginLeft = "auto";
      div.style.marginRight = "auto";
      const bonusText = fused === 'cosmic_maine' ? "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +300 CPS & +120 Click Value</div>" : fused === 'mythic_chimera' ? "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +500 CPS & +200 Click Value</div>" : "<div style='font-size:15px;margin-top:4px;color:#ad1457;'><b>Bonus:</b> +180 CPS & +90 Click Value</div>";
      div.innerHTML = `
        <div style="font-size:20px;margin-bottom:8px;"><b>${breedNames[fused]}</b></div>
        <img src="${breedImages[fused]}" alt="${breedNames[fused]}" style="width:120px;border-radius:14px;box-shadow:0 2px 8px #f8bbd0;">
        <div style="margin-top:7px;">
          <button class="breed-select-btn${selectedBreed===fused?" selected":""}"
            onclick="selectBreed('${fused}')">
            ${selectedBreed===fused ? "Selected" : "Select"}
          </button>
        </div>
        ${bonusText}
      `;
      list.appendChild(div);
    });
  }
  

  // Function to open overlays
  function openOverlay(id) {
    const el = document.getElementById(id);
    if (!el) return;
    if (id === 'shopOverlay') {
      el.style.display = 'flex';
    } else {
      el.style.display = 'block';
    }
    el.style.pointerEvents = 'auto';
    if(id === 'achievementsOverlay') renderAchievements();
    if(id === 'breedsOverlay') { renderBreeds(); renderFusionUI && renderFusionUI(); }
    if(id === 'settingsOverlay') updateSettingsUI();
    if(id === 'prestigeOverlay') updatePrestigeInfo();
    if(id === 'shopOverlay') { renderDynamicShop(); renderBundles(); updateShopAffordability(); }
  }

  window.openOverlay = openOverlay;
  window.closeOverlay = closeOverlay;
  window.openoverlay = function(id){ openOverlay(id); };
  window.closeoverlay = function(id){ closeOverlay(id); };
  
  // Close overlay function
  function closeOverlay(id) {
    const el = document.getElementById(id);
    if (el) { el.style.display = 'none'; el.style.pointerEvents = 'none'; }
  }
  
  function resetOverlays() {
    const overlays = document.querySelectorAll('.overlay');
    overlays.forEach(el => { el.style.display = 'none'; el.style.pointerEvents = 'none'; });
    const p = document.getElementById('prestigeOverlay');
    if (p) { p.style.display = 'none'; p.style.pointerEvents = 'none'; }
  }
  
  window.resetOverlays = resetOverlays;
  
  document.addEventListener('DOMContentLoaded', () => {
    resetOverlays();
  });
  
  window.addEventListener('load', () => {
    resetOverlays();
    updateUI();
  });
  
  // Function to create a notification
  function showNotification(text) {
    const notif = document.createElement('div');
    notif.className = 'notification';
    notif.textContent = text;
    document.body.appendChild(notif);
    setTimeout(() => notif.remove(), 3000);
  }

  // Save user data to Firebase
  

  // Load user data from Firebase
  

  // Toggle authentication state
  

  // Handle sign in
  

  // Handle sign up
  

  // Listen for auth state changes
  

  // Add event listener to auth button
  

  // Create falling kitten emoji function
  function createFallingKitten() {
    const kitten = document.createElement('div');
    kitten.className = 'falling-kitten';
    kitten.textContent = 'üê±';
    kitten.style.left = Math.random() * 100 + 'vw';
    kitten.style.animationDuration = (Math.random() * 3 + 2) + 's';
    document.body.appendChild(kitten);
    
    // Remove element after animation completes
    setTimeout(() => {
      kitten.remove();
    }, 5000);
  }

  // Create multiple falling kittens
  function createMultipleKittens(count) {
    for (let i = 0; i < count; i++) {
      setTimeout(() => {
        createFallingKitten();
      }, i * 100);
    }
  }

  // Update shop item affordability status
  function updateShopAffordability() {
    // Get all shop items
    const shopItems = document.querySelectorAll('.shop-item');
    
    shopItems.forEach(item => {
      const costElement = item.querySelector('.item-cost'); // Target the span with class item-cost
      if (costElement) {
        const cost = parseInt(costElement.textContent);
        if (kittens >= cost) {
          item.classList.add('can-afford');
        } else {
          item.classList.remove('can-afford');
        }
      }
    });
  }

  // Update player count from server
  async function updatePlayerCount() {
    try {
      const response = await fetch('/player-count');
      const data = await response.json();
      const cp = document.getElementById('currentPlayers');
      const tp = document.getElementById('totalPlayers');
      if (cp) cp.textContent = data.current.toLocaleString();
      if (tp) tp.textContent = data.total.toLocaleString();
    } catch (error) {
      console.error('Error fetching player count:', error);
      const cp = document.getElementById('currentPlayers');
      const tp = document.getElementById('totalPlayers');
      if (cp) cp.textContent = 'Error';
      if (tp) tp.textContent = 'Error';
    }
  }

  // Send heartbeat to server to indicate active player
  async function sendHeartbeat() {
    try {
      const trackingId = getTrackingId();
      await fetch('/heartbeat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ userId: trackingId })
      });
    } catch (error) {
      console.error('Error sending heartbeat:', error);
    }
  }

  // Start sending heartbeats periodically
  function startHeartbeat() {
    // Send initial heartbeat
    sendHeartbeat();
    // Then send every 10 seconds
    setInterval(sendHeartbeat, 10000);
  }

  function initApp() {
    try {
      resetOverlays();
      typeof ensureKittenImg === 'function' && ensureKittenImg();
      attachKittenHandlers();
      scheduleGoldenKitten();
      if (goldenKittenEl) {
        goldenKittenEl.addEventListener('click', onGoldenKittenClick, { passive: true });
      }
      const noProgress = kittens === 0 && Object.values(upgrades).every(v => v === 0) && prestigeLevel === 0;
      if (noProgress) {
        clickValue = 1;
      }
      updateUI();
      renderDynamicShop();
      renderBundles();
      updatePrestigeInfo();
      if (location.protocol !== 'file:') {
        startHeartbeat();
        startPlayerCountStream();
        updatePlayerCount();
      } else {
        const cp = document.getElementById('currentPlayers');
        const tp = document.getElementById('totalPlayers');
        if (cp) cp.textContent = 'Offline';
        if (tp) tp.textContent = 'Offline';
      }
    } catch (e) {
      console.error('Initialization error:', e);
    }
  }
  document.addEventListener('DOMContentLoaded', initApp);
  window.addEventListener('load', initApp);

  // Real-time player count using Server-Sent Events
  function startPlayerCountStream() {
    try {
      const eventSource = new EventSource('/player-count-stream');
      eventSource.onmessage = function(event) {
        try {
          const data = JSON.parse(event.data);
          const cp = document.getElementById('currentPlayers');
          const tp = document.getElementById('totalPlayers');
          if (cp) cp.textContent = data.current.toLocaleString();
          if (tp) tp.textContent = data.total.toLocaleString();
        } catch (e) {
          console.error('Error parsing player count:', e);
        }
      };
      eventSource.onerror = function(err) {
        console.error('Player count stream error:', err);
        setTimeout(startPlayerCountStream, 5000);
      };
    } catch (err) {
      console.error('SSE unsupported or failed to initialize', err);
    }
  }

  // Generate random 10-character ID (for local userlist save, if not using Firebase userId)
  function generateLocalUserId() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < 10; i++) {
      result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
  }

  // Save user data to /userlist
  async function saveToUserList() {
    if (location.protocol === 'file:' || !navigator.onLine) {
      return;
    }
    // Use tracking ID (userId if authenticated, sessionId if not)
    const trackingId = getTrackingId();
    
    if (!trackingId) {
      return; 
    }
    
    try {
      const saveData = { 
        userId: trackingId, 
        playerCount: kittens, 
        kittens, 
        clickValue, 
        upgrades, 
        upgradeCosts, 
        selectedBreed, 
        breedsUnlocked, 
        achievementsData, 
        userSettings, 
        bonusUpgrades, 
        bonusUpgradeCosts, 
        prestigeLevel, 
        offlineClicks, 
        offlineClickCost, 
        offlineBoost, 
        offlineBoostCost, 
        offlineEmpire, 
        offlineEmpireCost, 
        lastSeenTime 
      };
      
      const response = await fetch('/userlist', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(saveData)
      });
      
      if (response.ok) {
        console.log('Saved to user list successfully');
      } else {
        console.error('Failed to save to user list');
      }
    } catch (error) {
      console.error('Error saving to user list:', error);
    }
  }
  
  function showBreedsTab(tabName) {
    document.getElementById('breedsContent').classList.remove('active');
    document.getElementById('eventsContent').classList.remove('active');
    const fusionContent = document.getElementById('fusionContent');
    if (fusionContent) fusionContent.classList.remove('active');
    document.getElementById('tabBreeds').classList.remove('active');
    document.getElementById('tabEvents').classList.remove('active');
    const tabFusion = document.getElementById('tabFusion');
    if (tabFusion) tabFusion.classList.remove('active');
    document.getElementById(tabName + 'Content').classList.add('active');
    const activeTabId = 'tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1);
    const activeTab = document.getElementById(activeTabId);
    if (activeTab) activeTab.classList.add('active');
  }

  function renderFusionUI() {
    const selA = document.getElementById('fusionBreedA');
    const selB = document.getElementById('fusionBreedB');
    const res = document.getElementById('fusionResult');
    if (!selA || !selB || !res) return;
    selA.innerHTML = '';
    selB.innerHTML = '';
    const unlocked = Object.keys(breedsUnlocked).filter(b => breedsUnlocked[b] && b !== 'halloween_cat' && b !== 'christmas_kitten');
    unlocked.forEach(b => {
      const o1 = document.createElement('option');
      o1.value = b;
      o1.textContent = breedNames[b] || b;
      selA.appendChild(o1);
      const o2 = document.createElement('option');
      o2.value = b;
      o2.textContent = breedNames[b] || b;
      selB.appendChild(o2);
    });
    res.textContent = '';
  }

  function fuseBreeds() {
    const a = document.getElementById('fusionBreedA').value;
    const b = document.getElementById('fusionBreedB').value;
    if (!a || !b || a === b) { showNotification('Select two different breeds'); return; }
    const key = [a, b].sort().join('|');
    const result = fusionRecipes[key];
    if (!result) { showNotification('No fusion result for this pair'); return; }
    if (breedsUnlocked[result]) { showNotification('Breed already unlocked'); return; }
    breedsUnlocked[result] = true;
    showNotification(`Fused into ${breedNames[result]}!`);
    renderBreeds();
    updateUI();
    checkAchievements();
  }
  
  function showShopTab(tabName) {
    // Hide all content
    document.getElementById('clickValueContent').classList.remove('active');
    document.getElementById('autoContent').classList.remove('active');
    document.getElementById('bonusContent').classList.remove('active');
    const offlineContent = document.getElementById('offlineContent');
    if (offlineContent) offlineContent.classList.remove('active');
    const bundlesContent = document.getElementById('bundlesContent');
    if (bundlesContent) bundlesContent.classList.remove('active');
    
    // Remove active class from all tabs
    document.getElementById('tabClickValue').classList.remove('active');
    document.getElementById('tabAuto').classList.remove('active');
    document.getElementById('tabBonus').classList.remove('active');
    const tabOffline = document.getElementById('tabOffline');
    if (tabOffline) tabOffline.classList.remove('active');
    const tabBundles = document.getElementById('tabBundles');
    if (tabBundles) tabBundles.classList.remove('active');
    
    // Show selected content
    document.getElementById(tabName + 'Content').classList.add('active');
    
    // Add active class to selected tab
    document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
    if (tabName === 'auto') renderDynamicShop();
    if (tabName === 'bundles') renderBundles();
  }

  function renderDynamicShop() {
    const container = document.getElementById('dynamicAutoContainer');
    if (!container) return;
    container.innerHTML = '';
    const achCount = achievementsData.filter(a => a.achieved).length;
    if (achCount >= 12) {
      const div = document.createElement('div');
      div.className = 'shop-item';
      div.onclick = buyNebulaCursor;
      div.innerHTML = `<div class="shop-item-content"><strong class="item-text">Nebula Cursor</strong><br /><span class="item-text"> +15 CPS</span><br />
        <button id="nebulaCursorBtn">Buy for <span class="item-cost" id="nebulaCursorCost">${upgradeCosts.nebulaCursor}</span></button>
        <div class="upgrade-count" id="nebulaCursorCount">${upgrades.nebulaCursor}</div>
      </div>`;
      container.appendChild(div);
    }
    if (prestigeLevel >= 3) {
      const div = document.createElement('div');
      div.className = 'shop-item';
      div.onclick = buyStarForge;
      div.innerHTML = `<div class="shop-item-content"><strong class="item-text">Star Forge</strong><br /><span class="item-text"> +120 CPS</span><br />
        <button id="starForgeBtn">Buy for <span class="item-cost" id="starForgeCost">${upgradeCosts.starForge}</span></button>
        <div class="upgrade-count" id="starForgeCount">${upgrades.starForge}</div>
      </div>`;
      container.appendChild(div);
    }
    updateShopAffordability();
  }

  function computeBundlePrice(items, discount) {
    let sum = 0;
    for (const it of items) {
      if (it.type === 'click') sum += upgradeCosts[it.name];
      else if (it.type === 'auto') sum += upgradeCosts[it.name];
      else if (it.type === 'bonus') sum += bonusUpgradeCosts[it.name];
    }
    return Math.floor(sum * (1 - discount));
  }

  function applyUpgradePurchase(name, increment) {
    upgrades[name]++;
    clickValue += increment;
    upgradeCosts[name] = Math.ceil(upgradeCosts[name] * 1.15);
  }

  function applyAutoPurchase(name) {
    upgrades[name]++;
    upgradeCosts[name] = Math.ceil(upgradeCosts[name] * 1.15);
  }

  function applyBonusPurchase(name) {
    if (bonusUpgrades[name] >= 1) return false;
    bonusUpgrades[name] = 1;
    return true;
  }

  function buyBundle(bundleId) {
    const achCount = achievementsData.filter(a => a.achieved).length;
    let items = [];
    let discount = 0;
    if (bundleId === 'starter') {
      items = [
        { type: 'click', name: 'milkBowl', inc: 0.5 },
        { type: 'click', name: 'catFood', inc: 2 },
        { type: 'click', name: 'scratcher', inc: 7 }
      ];
      discount = 0.1;
    } else if (bundleId === 'auto') {
      if (achCount < 4) { showNotification('Unlock more achievements to buy this bundle'); return; }
      items = [
        { type: 'auto', name: 'autoClicker' },
        { type: 'auto', name: 'autoKittenFarm' }
      ];
      discount = 0.12;
    } else if (bundleId === 'prestige') {
      if (prestigeLevel < 2) { showNotification('Prestige to unlock this bundle'); return; }
      items = [
        { type: 'bonus', name: 'speedBoost' },
        { type: 'bonus', name: 'doublePoints' }
      ];
      discount = 0.15;
    }
    const price = computeBundlePrice(items, discount);
    if (kittens < price) { showNotification('Not enough kittens'); return; }
    kittens -= price;
    for (const it of items) {
      if (it.type === 'click') applyUpgradePurchase(it.name, it.inc);
      else if (it.type === 'auto') applyAutoPurchase(it.name);
      else if (it.type === 'bonus') {
        const ok = applyBonusPurchase(it.name);
        if (!ok) showNotification('Bundle skips purchased bonus');
      }
    }
    updateUI();
    renderBundles();
  }

  function renderBundles() {
    const container = document.getElementById('bundlesContainer');
    if (!container) return;
    container.innerHTML = '';
    const achCount = achievementsData.filter(a => a.achieved).length;
    const bundles = [
      { id: 'starter', title: 'Starter Bundle', desc: 'Milk Bowl + Cat Food + Scratcher', discount: 0.10, visible: true },
      { id: 'auto', title: 'Auto Bundle', desc: 'Auto-Mouse + Auto-Kitten Farm', discount: 0.12, visible: achCount >= 4 },
      { id: 'prestige', title: 'Prestige Bundle', desc: 'Speed Boost + Double Points', discount: 0.15, visible: prestigeLevel >= 2 }
    ];
    const itemDefs = {
      starter: [
        { type: 'click', name: 'milkBowl', inc: 0.5 },
        { type: 'click', name: 'catFood', inc: 2 },
        { type: 'click', name: 'scratcher', inc: 7 }
      ],
      auto: [
        { type: 'auto', name: 'autoClicker' },
        { type: 'auto', name: 'autoKittenFarm' }
      ],
      prestige: [
        { type: 'bonus', name: 'speedBoost' },
        { type: 'bonus', name: 'doublePoints' }
      ]
    };
    bundles.forEach(b => {
      if (!b.visible) return;
      const price = computeBundlePrice(itemDefs[b.id], b.discount);
      const div = document.createElement('div');
      div.className = 'shop-item';
      div.onclick = () => buyBundle(b.id);
      div.innerHTML = `<div class="shop-item-content"><strong class="item-text">${b.title}</strong><br /><span class="item-text"> ${b.desc} (${Math.round(b.discount*100)}% off)</span><br />
        <button id="${b.id}BundleBtn">Buy for <span class="item-cost" id="${b.id}BundleCost">${price}</span></button>
      </div>`;
      container.appendChild(div);
    });
    updateShopAffordability();
  }
  
  function checkAchievements() {
    let achievementsChanged = false;
    
    for (const ach of achievementsData) {
      if (!ach.achieved && ach.condition()) {
        ach.achieved = true;
        achievementsChanged = true;
      }
    }
    
    // Check breed unlocks after checking all achievements
    const breedUnlocks = [
      { breed: "maine_coon", requiredAchievements: 5, message: "You unlocked the Maine Coon breed!" },
      { breed: "siamese", requiredAchievements: 10, message: "You unlocked the Siamese breed!" },
      { breed: "himalayan", requiredAchievements: 15, message: "You unlocked the Himalayan breed!" },
      { breed: "ragdoll", requiredAchievements: 20, message: "You unlocked the Ragdoll breed!" },
      { breed: "persian", requiredAchievements: 25, message: "You unlocked the Persian breed!" },
      { breed: "bengal", requiredAchievements: 30, message: "You unlocked the Bengal breed!" }
    ];

    for (const unlock of breedUnlocks) {
      let achCount = achievementsData.reduce((acc, a) => acc + (a.achieved ? 1 : 0), 0);
      if (!breedsUnlocked[unlock.breed] && achCount >= unlock.requiredAchievements) {
        breedsUnlocked[unlock.breed] = true;
        showNotification(unlock.message);
        achievementsChanged = true;
      }
    }
    
    // Check if we can unlock Halloween cat
    if (!breedsUnlocked.halloween_cat) {
      const achievementCount = achievementsData.filter(a => a.achieved).length;
      if (achievementCount >= 20 && kittens >= 200000) {
        // Unlock Halloween cat if it's Halloween season
        const now = new Date();
        const isHalloween = (now.getMonth() === 9 && now.getDate() >= 20 && now.getDate() <= 31) || 
                            (now.getMonth() === 10 && now.getDate() <= 1);
        
        if (isHalloween) {
          breedsUnlocked.halloween_cat = true;
          showNotification("You unlocked the Halloween Cat! It will remain unlocked.");
          achievementsChanged = true;
        }
      }
    }
    
    // Check if we can unlock Christmas kitten
    if (!breedsUnlocked.christmas_kitten) {
      const achievementCount = achievementsData.filter(a => a.achieved).length;
      const now = new Date();
    const isChristmas = (now.getMonth() === 11 && now.getDate() >= 1 && now.getDate() <= 31);
      
      // Unlock based on kittens (score), not manual click count
      if (isChristmas && kittens >= 100000 && achievementCount >= 12) {
        breedsUnlocked.christmas_kitten = true;
        showNotification("You unlocked the Christmas Kitten! It will remain unlocked.");
        achievementsChanged = true;
      }
    }
    
    // Check for Cat of the Cosmos unlock
    if (!breedsUnlocked.cat_of_the_cosmos) {
      const achievementCount = achievementsData.filter(a => a.achieved).length;
      if (achievementCount >= 25) {
        breedsUnlocked.cat_of_the_cosmos = true;
        showNotification("You unlocked the Cat of the Cosmos! It will remain unlocked.");
        achievementsChanged = true;
      }
    }

    
    
    if (achievementsChanged) {
      renderAchievements();
      renderBreeds();
    }
  }
  
  function attachKittenHandlers() {
    if (!kittenImg) return;
    if (kittenImg.__handlersAttached) return;
  const onClick = () => {
      if (clickSound) {
        clickSound.currentTime = 0;
        clickSound.volume = userSettings.notifVolume;
        Promise.resolve(clickSound.play()).catch(()=>{});
      }
      manualClickCount++;
      if (manualClickCount % 100 === 0) {
        if (meowSound) {
          meowSound.currentTime = 0;
          meowSound.volume = userSettings.notifVolume;
          Promise.resolve(meowSound.play()).catch(()=>{});
        }
      }
      registerManualClick(clickValue);
      createMultipleKittens(5);
      if(!userSettings.disableAnimations){
        kittenImg.classList.add('pulse');
        setTimeout(() => kittenImg.classList.remove('pulse'), 300);
      }
    };
    kittenImg.addEventListener('click', onClick, { passive: true });
    kittenImg.addEventListener('touchstart', (e) => { e.preventDefault(); onClick(); }, { passive: false });
    kittenImg.__handlersAttached = true;
  }

  // Attach immediately if possible and also on DOM ready
  attachKittenHandlers();
  document.addEventListener('DOMContentLoaded', attachKittenHandlers);
  document.addEventListener('keydown', function(e) {
    if (e.code === 'Space' && !e.repeat) {
      const ae = document.activeElement;
      const typing = ae && (ae.tagName === 'INPUT' || ae.tagName === 'TEXTAREA' || ae.isContentEditable);
      if (!typing) {
        e.preventDefault();
        if (kittenImg) kittenImg.click();
      }
    }
  });
  
  function registerManualClick(baseValue) {
    streakCount++;
    if (streakTimer) clearTimeout(streakTimer);
    streakTimer = setTimeout(() => { streakCount = 0; updateComboMeter(1); }, 1200);
    const streakMult = 1 + Math.min(streakCount / 25, 2);
    updateComboMeter(streakMult);
    let critMult = 1;
    if (Math.random() < criticalChance) {
      critMult = Math.random() < 0.5 ? 2 : 5;
    }
    const final = Math.floor(baseValue * streakMult * critMult);
    addScore(final);
    saveProgress();
    if (critMult > 1 && userSettings.floatScore) {
      showFloatingScore(final);
    }
  }
  
  function updateComboMeter(mult) {
    if (!comboMeterEl) return;
    if (streakCount <= 0 || mult <= 1) {
      comboMeterEl.style.display = 'none';
      comboMeterEl.textContent = 'Combo x1.0';
    } else {
      comboMeterEl.style.display = '';
      comboMeterEl.textContent = 'Combo x' + mult.toFixed(1);
    }
  }

  function scheduleGoldenKitten() {
    const delay = 15000 + Math.floor(Math.random() * 30000);
    setTimeout(spawnGoldenKitten, delay);
  }

  function spawnGoldenKitten() {
    if (!goldenKittenEl) return;
    const x = Math.floor(Math.random() * (window.innerWidth - 60));
    const y = Math.floor(Math.random() * (window.innerHeight - 120)) + 60;
    goldenKittenEl.style.left = x + 'px';
    goldenKittenEl.style.top = y + 'px';
    goldenKittenEl.style.display = '';
    setTimeout(() => { if (goldenKittenEl) goldenKittenEl.style.display = 'none'; scheduleGoldenKitten(); }, 6000);
  }

  function onGoldenKittenClick() {
    if (!goldenKittenEl) return;
    goldenKittenEl.style.display = 'none';
    const reward = Math.max(5000, Math.floor(kittens * 0.1));
    kittens += reward;
    if (userSettings.floatScore) showFloatingScore(reward);
    goldenBoostCPS = 100;
    if (goldenBoostTimer) clearTimeout(goldenBoostTimer);
    goldenBoostTimer = setTimeout(() => { goldenBoostCPS = 0; }, 20000);
    updateUI();
    checkAchievements();
    scheduleGoldenKitten();
  }
  
  function addScore(amount) {
    kittens += amount;
    if(userSettings.floatScore)
      showFloatingScore(amount);
    updateUI();
    checkAchievements();
    saveProgress();
  }
  
  function showFloatingScore(amount) {
    if (!kittenImg) return;
    const floatEl = document.createElement('div');
    floatEl.className = 'floating-score';
    floatEl.textContent = (amount >= 0 ? '+' : '') + Math.floor(amount);
    floatEl.style.left = `${window.innerWidth/2}px`;
    floatEl.style.top = `${kittenImg.getBoundingClientRect().top}px`;
    floatEl.style.color = amount >= 0 ? '#c2185b' : '#b71c1c';
    document.body.appendChild(floatEl);
    setTimeout(() => floatEl.remove(), 1500);
  }
  
  // Calculate bonus multipliers
  function calculateBonusMultipliers() {
    let clickMultiplier = 1;
    let scoreMultiplier = 1;
    let cpsMultiplier = 1;
    
    // Apply prestige bonuses
    clickMultiplier += prestigeBonuses.clickValue * prestigeLevel;
    scoreMultiplier += prestigeBonuses.scoreMultiplier * prestigeLevel;
    cpsMultiplier += prestigeBonuses.cps * prestigeLevel;
    
    if (bonusUpgrades.speedBoost > 0) {
      clickMultiplier += bonusUpgrades.speedBoost * 0.05;
    }
    
    if (bonusUpgrades.doublePoints > 0) {
      scoreMultiplier += bonusUpgrades.doublePoints * 0.1;
    }
    
    if (bonusUpgrades.goldenPaws > 0) {
      cpsMultiplier += bonusUpgrades.goldenPaws * 0.2;
    }
    
    return { clickMultiplier, scoreMultiplier, cpsMultiplier };
  }
  
  function updateUI() {
    let breedCPS = extraCPSBreed[selectedBreed] || 0;
    if (!breedImages[selectedBreed]) { selectedBreed = 'american_shorthair'; breedCPS = extraCPSBreed[selectedBreed] || 0; }
    
    // Calculate bonus multipliers
    const bonuses = calculateBonusMultipliers();

    // --- Calculate total CPS ---
    const totalCPS = (upgrades.autoClicker * 5 + 
                      upgrades.autoKittenFarm * 7 + 
                      upgrades.kittenPlanet * 30 + 
                      upgrades.nebulaCursor * 15 +
                      upgrades.starForge * 120 +
                      breedCPS) * bonuses.cpsMultiplier;

    // Format large numbers
    function formatNumber(num) {
      if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
      } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
      }
      return Math.floor(num);
    }
    
    if (scoreEl) scoreEl.textContent = `Kittens: ${formatNumber(kittens * bonuses.scoreMultiplier)}`;
    
    // --- Breed click bonus ---
    let breedClickBonus = 0;
    if (selectedBreed === 'maine_coon') {
      breedClickBonus = 5;
    } else if (selectedBreed === 'siamese') {
      breedClickBonus = 50;
    } else if (selectedBreed === 'himalayan') {
      breedClickBonus = 75;
    } else if (selectedBreed === 'halloween_cat') {
      breedClickBonus = 200;
    } else if (selectedBreed === 'christmas_kitten') {
      breedClickBonus = 150;
    } else if (selectedBreed === 'cat_of_the_cosmos') {
      breedClickBonus = 500;
    } else if (selectedBreed === 'ragdoll') {
      breedClickBonus = 30;
    } else if (selectedBreed === 'persian') {
      breedClickBonus = 20;
    } else if (selectedBreed === 'bengal') {
      breedClickBonus = 40;
    } else if (selectedBreed === 'cosmic_maine') {
      breedClickBonus = 120;
    } else if (selectedBreed === 'mythic_chimera') {
      breedClickBonus = 200;
    } else if (selectedBreed === 'wild_ragdoll') {
      breedClickBonus = 90;
    }

    // Apply click bonus multiplier
    const finalClickValue = (clickValue + breedClickBonus) * bonuses.clickMultiplier;
    if (clickValueEl) clickValueEl.textContent = finalClickValue.toFixed(1);
    
    if (autoClickersEl) autoClickersEl.textContent = totalCPS.toFixed(1);
    if (kittenImg) kittenImg.src = breedImages[selectedBreed];
    
    // Update upgrade costs
    if(document.getElementById('milkBowlCost')) document.getElementById('milkBowlCost').textContent = upgradeCosts.milkBowl;
    if(document.getElementById('catFoodCost')) document.getElementById('catFoodCost').textContent = upgradeCosts.catFood;
    if(document.getElementById('scratcherCost')) document.getElementById('scratcherCost').textContent = upgradeCosts.scratcher;
    if(document.getElementById('kittenFactoryCost')) document.getElementById('kittenFactoryCost').textContent = upgradeCosts.kittenFactory;
    if(document.getElementById('cityOfKittensCost')) document.getElementById('cityOfKittensCost').textContent = upgradeCosts.cityOfKittens;
    if(document.getElementById('worldOfMeowsCost')) document.getElementById('worldOfMeowsCost').textContent = upgradeCosts.worldOfMeows;
    if(document.getElementById('goldKittyCost')) document.getElementById('goldKittyCost').textContent = upgradeCosts.goldKitty;
    if(document.getElementById('autoClickerCost')) document.getElementById('autoClickerCost').textContent = upgradeCosts.autoClicker;
    if(document.getElementById('autoKittenFarmCost')) document.getElementById('autoKittenFarmCost').textContent = upgradeCosts.autoKittenFarm;
    if(document.getElementById('kittenPlanetCost')) document.getElementById('kittenPlanetCost').textContent = upgradeCosts.kittenPlanet;
    if(document.getElementById('nebulaCursorCost')) document.getElementById('nebulaCursorCost').textContent = upgradeCosts.nebulaCursor;
    if(document.getElementById('starForgeCost')) document.getElementById('starForgeCost').textContent = upgradeCosts.starForge;
    
    if(document.getElementById('offlineClickCost')) document.getElementById('offlineClickCost').textContent = offlineClickCost;
    if(document.getElementById('offlineEfficiencyCost')) document.getElementById('offlineEfficiencyCost').textContent = offlineEfficiencyCost;
    if(document.getElementById('offlineHibernateCost')) document.getElementById('offlineHibernateCost').textContent = offlineHibernateCost;
    if(document.getElementById('offlineTimeCapsuleCost')) document.getElementById('offlineTimeCapsuleCost').textContent = offlineTimeCapsuleCost;
    
    // Update button states for regular and auto upgrades
    if(document.getElementById('milkBowlBtn')) document.getElementById('milkBowlBtn').disabled = kittens < upgradeCosts.milkBowl;
    if(document.getElementById('catFoodBtn')) document.getElementById('catFoodBtn').disabled = kittens < upgradeCosts.catFood;
    if(document.getElementById('scratcherBtn')) document.getElementById('scratcherBtn').disabled = kittens < upgradeCosts.scratcher;
    if(document.getElementById('kittenFactoryBtn')) document.getElementById('kittenFactoryBtn').disabled = kittens < upgradeCosts.kittenFactory;
    if(document.getElementById('cityOfKittensBtn')) document.getElementById('cityOfKittensBtn').disabled = kittens < upgradeCosts.cityOfKittens;
    if(document.getElementById('worldOfMeowsBtn')) document.getElementById('worldOfMeowsBtn').disabled = kittens < upgradeCosts.worldOfMeows;
    if(document.getElementById('goldKittyBtn')) document.getElementById('goldKittyBtn').disabled = kittens < upgradeCosts.goldKitty;
    if(document.getElementById('autoClickerBtn')) document.getElementById('autoClickerBtn').disabled = kittens < upgradeCosts.autoClicker;
    if(document.getElementById('autoKittenFarmBtn')) document.getElementById('autoKittenFarmBtn').disabled = kittens < upgradeCosts.autoKittenFarm;
    if(document.getElementById('kittenPlanetBtn')) document.getElementById('kittenPlanetBtn').disabled = kittens < upgradeCosts.kittenPlanet;
    if(document.getElementById('nebulaCursorBtn')) document.getElementById('nebulaCursorBtn').disabled = kittens < upgradeCosts.nebulaCursor;
    if(document.getElementById('starForgeBtn')) document.getElementById('starForgeBtn').disabled = kittens < upgradeCosts.starForge;

    if(document.getElementById('offlineClickBtn')) document.getElementById('offlineClickBtn').disabled = kittens < offlineClickCost;
    if(document.getElementById('offlineEfficiencyBtn')) document.getElementById('offlineEfficiencyBtn').disabled = kittens < offlineEfficiencyCost;
    if(document.getElementById('offlineHibernateBtn')) document.getElementById('offlineHibernateBtn').disabled = kittens < offlineHibernateCost;
    if(document.getElementById('offlineTimeCapsuleBtn')) document.getElementById('offlineTimeCapsuleBtn').disabled = kittens < offlineTimeCapsuleCost;

    // Update bonus upgrade costs and counts (one-time purchase logic)
    const bonusUpgradeNames = ['speedBoost', 'doublePoints', 'goldenPaws'];
    bonusUpgradeNames.forEach(name => {
      const btn = document.getElementById(`${name}Btn`);
      const costEl = document.getElementById(`${name}Cost`);
      const countEl = document.getElementById(`${name}Count`);

      if (btn) {
        if (bonusUpgrades[name] >= 1) {
          btn.disabled = true;
          btn.textContent = 'Purchased';
          if (countEl) countEl.style.display = 'none'; // Hide count for one-time purchase
        } else {
          btn.disabled = kittens < bonusUpgradeCosts[name];
          if (costEl) costEl.textContent = bonusUpgradeCosts[name];
          btn.textContent = 'Buy'; // Ensure button text is 'Buy' if not purchased
          if (countEl) {
            countEl.style.display = 'flex'; // Show count if not purchased
            countEl.textContent = bonusUpgrades[name]; // This will be 0
          }
        }
      }
    });
    
    // Update upgrade counts for regular and auto upgrades
    if(document.getElementById('milkBowlCount')) document.getElementById('milkBowlCount').textContent = upgrades.milkBowl;
    if(document.getElementById('catFoodCount')) document.getElementById('catFoodCount').textContent = upgrades.catFood;
    if(document.getElementById('scratcherCount')) document.getElementById('scratcherCount').textContent = upgrades.scratcher;
    if(document.getElementById('kittenFactoryCount')) document.getElementById('kittenFactoryCount').textContent = upgrades.kittenFactory;
    if(document.getElementById('cityOfKittensCount')) document.getElementById('cityOfKittensCount').textContent = upgrades.cityOfKittens;
    if(document.getElementById('worldOfMeowsCount')) document.getElementById('worldOfMeowsCount').textContent = upgrades.worldOfMeows;
    if(document.getElementById('goldKittyCount')) document.getElementById('goldKittyCount').textContent = upgrades.goldKitty;
    if(document.getElementById('autoClickerCount')) document.getElementById('autoClickerCount').textContent = upgrades.autoClicker;
    if(document.getElementById('autoKittenFarmCount')) document.getElementById('autoKittenFarmCount').textContent = upgrades.autoKittenFarm;
    if(document.getElementById('kittenPlanetCount')) document.getElementById('kittenPlanetCount').textContent = upgrades.kittenPlanet;
    if(document.getElementById('nebulaCursorCount')) document.getElementById('nebulaCursorCount').textContent = upgrades.nebulaCursor;
    if(document.getElementById('starForgeCount')) document.getElementById('starForgeCount').textContent = upgrades.starForge;
    
    if(document.getElementById('offlineClickCount')) document.getElementById('offlineClickCount').textContent = offlineClicks;
    if(document.getElementById('offlineEfficiencyCount')) document.getElementById('offlineEfficiencyCount').textContent = offlineEfficiency;
    if(document.getElementById('offlineHibernateCount')) document.getElementById('offlineHibernateCount').textContent = offlineHibernate;
    if(document.getElementById('offlineTimeCapsuleCount')) document.getElementById('offlineTimeCapsuleCount').textContent = offlineTimeCapsule;
    
    // Update prestige button state
    const requirement = Math.pow(10, 6 + prestigeLevel);
    prestigeButton.disabled = kittens < requirement;
    prestigeRequirementEl.textContent = requirement.toLocaleString();
    
    // Create falling kittens if CPS > 20
    if (totalCPS > 20) {
      createMultipleKittens(3);
    }
    
    // Update shop affordability
    updateShopAffordability();
  }
  
  // Fixed functions for all shop upgrades
  function buyUpgrade(name, increment) {
    if (kittens >= upgradeCosts[name]) {
      kittens -= upgradeCosts[name];
      clickValue += increment;
      upgrades[name]++;
      upgradeCosts[name] = Math.ceil(upgradeCosts[name] * 1.3);
      updateUI();
      saveProgress();
    }
  }
  
  function buyAutoClicker() {
    if (kittens >= upgradeCosts.autoClicker) {
      kittens -= upgradeCosts.autoClicker;
      upgrades.autoClicker++;
      upgradeCosts.autoClicker = Math.ceil(upgradeCosts.autoClicker * 1.3);
      updateUI();
      saveProgress();
    }
  }
  
  function buyAutoKittenFarm() {
    if (kittens >= upgradeCosts.autoKittenFarm) {
      kittens -= upgradeCosts.autoKittenFarm;
      upgrades.autoKittenFarm++;
      upgradeCosts.autoKittenFarm = Math.ceil(upgradeCosts.autoKittenFarm * 1.3);
      updateUI();
      saveProgress();
    }
  }
  
  function buyKittenPlanet() {
    if (kittens >= upgradeCosts.kittenPlanet) {
      kittens -= upgradeCosts.kittenPlanet;
      upgrades.kittenPlanet++;
      upgradeCosts.kittenPlanet = Math.ceil(upgradeCosts.kittenPlanet * 1.3);
      updateUI();
      saveProgress();
    }
  }

  function buyNebulaCursor() {
    if (kittens >= upgradeCosts.nebulaCursor) {
      kittens -= upgradeCosts.nebulaCursor;
      upgrades.nebulaCursor++;
      upgradeCosts.nebulaCursor = Math.ceil(upgradeCosts.nebulaCursor * 1.3);
      updateUI();
      saveProgress();
    }
  }

  function buyStarForge() {
    if (kittens >= upgradeCosts.starForge) {
      kittens -= upgradeCosts.starForge;
      upgrades.starForge++;
      upgradeCosts.starForge = Math.ceil(upgradeCosts.starForge * 1.3);
      updateUI();
      saveProgress();
    }
  }
  
  // Bonus upgrade purchase function
  function buyBonusUpgrade(name, multiplier) {
    // Check if the upgrade has already been bought
    if (bonusUpgrades[name] >= 1) {
      showNotification(`You can only buy ${name} once!`);
      return;
    }

    if (kittens >= bonusUpgradeCosts[name]) {
      kittens -= bonusUpgradeCosts[name];
      bonusUpgrades[name]++; // Increment to 1
      // No need to increase cost if it's a one-time purchase
      // bonusUpgradeCosts[name] = Math.ceil(bonusUpgradeCosts[name] * 1.2);
      updateUI();
      saveProgress();
    }
  }
  
  // Offline click system
  function calculateOfflineBonus() {
    const now = Date.now();
    const offlineTime = (now - lastSeenTime) / 1000; // in seconds
    
    if (offlineTime <= 0) return 0;
    
    let baseClicksPerSecond = (function(){
      let breedCPS = extraCPSBreed[selectedBreed] || 0;
      let gb = (typeof goldenBoostCPS !== 'undefined') ? goldenBoostCPS : 0;
      return (
        upgrades.autoClicker * 5 +
        upgrades.autoKittenFarm * 7 +
        upgrades.kittenPlanet * 30 +
        upgrades.nebulaCursor * 15 +
        upgrades.starForge * 120 +
        breedCPS + gb
      ) + offlineClicks + (offlineHibernate * 0.5);
    })();
    
    // Apply boosts
    let boostMultiplier = 1 + (offlineEfficiency * 0.05) + (offlineTimeCapsule * 0.15);
    
    // Calculate total offline bonus
    const offlineBonus = baseClicksPerSecond * offlineTime * boostMultiplier;
    
    return offlineBonus;
  }
  
  // Show offline bonus notification
  function showOfflineBonus() {
    const bonus = calculateOfflineBonus();
    if (bonus > 0) {
      showNotification(`Offline Bonus: +${Math.floor(bonus)} kittens`);
      kittens += bonus;
      updateUI();
    }
  }
  
  
  function buyOfflineClick() {
    if (kittens >= offlineClickCost) {
      kittens -= offlineClickCost;
      offlineClicks++;
      offlineClickCost = Math.ceil(offlineClickCost * 1.6);
      updateUI();
      saveProgress();
    }
  }
  function buyOfflineEfficiency() {
    if (kittens >= offlineEfficiencyCost) {
      kittens -= offlineEfficiencyCost;
      offlineEfficiency++;
      offlineEfficiencyCost = Math.ceil(offlineEfficiencyCost * 1.8);
      updateUI();
      saveProgress();
    }
  }
  function buyOfflineHibernate() {
    if (kittens >= offlineHibernateCost) {
      kittens -= offlineHibernateCost;
      offlineHibernate++;
      offlineHibernateCost = Math.ceil(offlineHibernateCost * 1.8);
      updateUI();
      saveProgress();
    }
  }
  function buyOfflineTimeCapsule() {
    if (kittens >= offlineTimeCapsuleCost) {
      kittens -= offlineTimeCapsuleCost;
      offlineTimeCapsule++;
      offlineTimeCapsuleCost = Math.ceil(offlineTimeCapsuleCost * 2.0);
      updateUI();
      saveProgress();
    }
  }
  
  setInterval(() => {
    let breedCPS = extraCPSBreed[selectedBreed] || 0;
    let gb = (typeof goldenBoostCPS !== 'undefined') ? goldenBoostCPS : 0;
    const totalCPS = (
      upgrades.autoClicker * 5 +
      upgrades.autoKittenFarm * 7 +
      upgrades.kittenPlanet * 30 +
      upgrades.nebulaCursor * 15 +
      upgrades.starForge * 120 +
      breedCPS + gb
    );
    if (totalCPS > 0) { addScore(totalCPS); }
  }, 1000);
  
  window.selectBreed = function(breed) {
    if (!breedsUnlocked[breed]) return; // Do nothing if breed is locked

    // Check if it's Cat of the Cosmos and requirements are met
    if (breed === 'cat_of_the_cosmos') {
      const achievementCount = achievementsData.filter(a => a.achieved).length;
      if (achievementCount < 20) {
        showNotification("You need 15 achievements to unlock the Cat of the Cosmos!");
        return;
      }
      
      // Unlock the breed if requirements are met
      if (!breedsUnlocked[breed]) {
        breedsUnlocked[breed] = true;
        showNotification("You unlocked the Cat of the Cosmos! It will remain unlocked.");
      }
    }

    // Check if it's halloween cat and requirements are met
    if (breed === 'halloween_cat') {
      const now = new Date();
      const isHalloween = (now.getMonth() === 9 && now.getDate() >= 20 && now.getDate() <= 31) || 
                          (now.getMonth() === 10 && now.getDate() <= 1);
      
      // If already unlocked, allow selection anytime
      if (breedsUnlocked[breed]) {
        // Allow selection
      } else {
        // Check if it's Halloween season and requirements are met
        if (!isHalloween) {
          showNotification("Halloween Cat is only available from Oct 20-31!");
          return;
        }
        
        const achievementCount = achievementsData.filter(a => a.achieved).length;
        if (kittens < 200000 || achievementCount < 20) {
          showNotification("You need 200,000 kittens and 20 achievements to unlock the Halloween Cat!");
          return;
        }
        
        // Unlock the breed if requirements are met
        breedsUnlocked[breed] = true;
        showNotification("You unlocked the Halloween Cat! It will remain unlocked.");
      }
    }

    // Check if it's Christmas kitten and requirements are met
    if (breed === 'christmas_kitten') {
      const now = new Date();
      const isChristmas = (now.getMonth() === 11 && now.getDate() >= 12 && now.getDate() <= 31);
      
      // If already unlocked, allow selection anytime
      if (breedsUnlocked[breed]) {
        // Allow selection
      } else {
        // Check if it's Christmas season and requirements are met
        if (!isChristmas) {
          showNotification("Christmas Kitten is only available from Dec 1-31!");
          return;
        }
        
        const achievementCount = achievementsData.filter(a => a.achieved).length;
        if (manualClickCount < 10000 || achievementCount < 8) {
          showNotification("You need 10,000 clicks and 8 achievements to unlock the Christmas Kitten!");
          return;
        }
        
        // Unlock the breed if requirements are met
        breedsUnlocked[breed] = true;
        showNotification("You unlocked the Christmas Kitten! It will remain unlocked.");
      }
    }

    // Remove the reset of clickValue here
    // Instead, just update the breed and UI
    if (selectedBreed !== breed) {
        selectedBreed = breed;

        // Breed-specific click bonus will be handled in updateUI()
        // and we do NOT reset clickValue here.
        // updateUI() will now handle the display with breed bonus.
        updateUI();
        checkAchievements();
        renderBreeds();
    }
  };
  
  function exportSave() {
    const saveData = { kittens, clickValue, upgrades, upgradeCosts, selectedBreed, breedsUnlocked, achievementsData, userSettings, bonusUpgrades, bonusUpgradeCosts, prestigeLevel, offlineClicks, offlineClickCost, offlineBoost, offlineBoostCost, offlineEmpire, offlineEmpireCost, offlineEfficiency, offlineEfficiencyCost, offlineHibernate, offlineHibernateCost, offlineTimeCapsule, offlineTimeCapsuleCost, lastSeenTime };
    const saveString = JSON.stringify(saveData);
    const textarea = document.getElementById('saveCodeBox');
    textarea.value = saveString;
    textarea.select();
  }
  
  function loadSave() {
    const input = document.getElementById('loadSaveCode').value;
    try {
      let data;
      try { data = JSON.parse(input); }
      catch(_) { data = JSON.parse(atob(input)); }
      kittens = data.kittens || 0;
      clickValue = data.clickValue || 1;
      upgrades = data.upgrades || upgrades;
      upgradeCosts = data.upgradeCosts || upgradeCosts;
      selectedBreed = data.selectedBreed || "american_shorthair";
      breedsUnlocked = data.breedsUnlocked || breedsUnlocked;
      if (Array.isArray(data.achievementsData)) {
        for (let ach of data.achievementsData) {
          const found = achievementsData.find(a => a.id === ach.id);
          if (found) found.achieved = ach.achieved;
        }
      }
      if (data.userSettings) {
        userSettings = data.userSettings;
        applyTheme(userSettings.theme);
      }
      if (data.bonusUpgrades) bonusUpgrades = data.bonusUpgrades;
      if (data.bonusUpgradeCosts) bonusUpgradeCosts = data.bonusUpgradeCosts;
      if (data.prestigeLevel !== undefined) prestigeLevel = data.prestigeLevel;
      if (data.offlineClicks !== undefined) offlineClicks = data.offlineClicks;
      if (data.offlineClickCost !== undefined) offlineClickCost = data.offlineClickCost;
      if (data.offlineBoost !== undefined) offlineBoost = data.offlineBoost;
      if (data.offlineBoostCost !== undefined) offlineBoostCost = data.offlineBoostCost;
      if (data.offlineEmpire !== undefined) offlineEmpire = data.offlineEmpire;
      if (data.offlineEmpireCost !== undefined) offlineEmpireCost = data.offlineEmpireCost;
      if (data.offlineEfficiency !== undefined) offlineEfficiency = data.offlineEfficiency;
      if (data.offlineEfficiencyCost !== undefined) offlineEfficiencyCost = data.offlineEfficiencyCost;
      if (data.offlineHibernate !== undefined) offlineHibernate = data.offlineHibernate;
      if (data.offlineHibernateCost !== undefined) offlineHibernateCost = data.offlineHibernateCost;
      if (data.offlineTimeCapsule !== undefined) offlineTimeCapsule = data.offlineTimeCapsule;
      if (data.offlineTimeCapsuleCost !== undefined) offlineTimeCapsuleCost = data.offlineTimeCapsuleCost;
      if (data.lastSeenTime !== undefined) lastSeenTime = data.lastSeenTime;
      updateUI();
      renderAchievements();
      renderBreeds();
      updatePrestigeInfo();
      alert('Save loaded!');
    } catch (e) {
      alert('Invalid save code.');
    }
  }

  document.getElementById('saveCodeBox').addEventListener('click', function() {
    this.select();
  });

  document.getElementById('themeSelect').addEventListener('change', function() {
    userSettings.theme = this.value;
    applyTheme(userSettings.theme);
    try { localStorage.setItem('kittenTheme', userSettings.theme); } catch (e) {}
  });
  
  // Floating Score toggle
  document.getElementById('floatScoreToggle').addEventListener('change', function() {
    userSettings.floatScore = this.checked;
  });
  
  // Notification volume
  document.getElementById('notifVolume').addEventListener('input', function() {
    userSettings.notifVolume = parseFloat(this.value);
  });
  
  // Disable animations
  document.getElementById('disableAnimations').addEventListener('change', function() {
    userSettings.disableAnimations = this.checked;
  });
  
  // Reset
  function resetProgress() {
    if(confirm('Are you sure you want to reset all progress?')) {
      kittens = 0; clickValue = 1;
      upgrades = {milkBowl:0,catFood:0,scratcher:0,kittenFactory:0,cityOfKittens:0,worldOfMeows:0,autoClicker:0,autoKittenFarm:0,kittenPlanet:0,goldKitty:0,nebulaCursor:0,starForge:0};
      upgradeCosts = {milkBowl:50,catFood:200,scratcher:800,kittenFactory:5000,cityOfKittens:25000,worldOfMeows:100000,autoClicker:500,autoKittenFarm:2500,kittenPlanet:1000000,goldKitty:2000000,nebulaCursor:750000,starForge:5000000};
      selectedBreed = "american_shorthair";
      breedsUnlocked = { american_shorthair: true, maine_coon: false, siamese: false, himalayan: false, halloween_cat: false, christmas_kitten: false, cat_of_the_cosmos: false, ragdoll: false, persian: false, bengal: false, calico: false, sphynx: false, cosmic_maine: false, mythic_chimera: false, wild_ragdoll: false };
      for(let a of achievementsData) a.achieved = false;
      bonusUpgrades = { speedBoost: 0, doublePoints: 0, goldenPaws: 0 };
      bonusUpgradeCosts = { speedBoost: 5000, doublePoints: 15000, goldenPaws: 50000 };
      prestigeLevel = 0;
      offlineClicks = 0;
      offlineClickCost = 5000;
      offlineBoost = 0;
      offlineBoostCost = 5000;
      offlineEmpire = 0;
      offlineEmpireCost = 25000;
      offlineEfficiency = 0;
      offlineEfficiencyCost = 250000;
      offlineHibernate = 0;
      offlineHibernateCost = 500000;
      offlineTimeCapsule = 0;
      offlineTimeCapsuleCost = 1000000;
      lastSeenTime = 0;
      userSettings = {theme:"pink", floatScore:true, notifVolume:1, disableAnimations:false};
      applyTheme(userSettings.theme);
      updateUI(); renderDynamicShop(); renderBundles(); renderAchievements(); renderBreeds(); updatePrestigeInfo();
      try { localStorage.removeItem('kittenSave'); } catch(e){}
    }
  }

  function applySeasonalDecorations() {
    const overlay = document.getElementById('shopOverlay');
    const header = overlay ? overlay.querySelector('.shop-header h2') : null;
    const now = new Date();
    const month = now.getMonth() + 1;
    const day = now.getDate();
    if (overlay && month === 12 && day >= 1 && day <= 31) {
      overlay.classList.add('christmas-shop');
      if (header) header.textContent = 'Kitten Shop üéÑ';
    } else if (overlay) {
      overlay.classList.remove('christmas-shop');
      if (header) header.textContent = 'Kitten Shop';
    }
  }

  // --- SAVE/LOAD ON PAGE LOAD ---
  window.addEventListener('load', () => {
    try {
      let loaded = loadFromCookies();
      if (!loaded) {
        const saved = localStorage.getItem('kittenSave');
        if (saved) {
          let data = null;
          try { data = JSON.parse(saved); }
          catch(_) { try { data = JSON.parse(atob(saved)); } catch(_) {} }
          if (data) {
            kittens = data.kittens || 0;
            clickValue = data.clickValue || 1;
            upgrades = data.upgrades || upgrades;
            upgradeCosts = data.upgradeCosts || upgradeCosts;
            selectedBreed = data.selectedBreed || "american_shorthair";
            breedsUnlocked = data.breedsUnlocked || breedsUnlocked;
            if (Array.isArray(data.achievementsData)) {
              for (let ach of data.achievementsData) {
                const found = achievementsData.find(a => a.id === ach.id);
                if (found) found.achieved = ach.achieved;
              }
            }
            if (data.userSettings) {
              userSettings = data.userSettings;
            }
            if (data.bonusUpgrades) bonusUpgrades = data.bonusUpgrades;
            if (data.bonusUpgradeCosts) bonusUpgradeCosts = data.bonusUpgradeCosts;
            if (data.prestigeLevel !== undefined) prestigeLevel = data.prestigeLevel;
            if (data.offlineClicks !== undefined) offlineClicks = data.offlineClicks;
            if (data.offlineClickCost !== undefined) offlineClickCost = data.offlineClickCost;
            if (data.offlineBoost !== undefined) offlineBoost = data.offlineBoost;
            if (data.offlineBoostCost !== undefined) offlineBoostCost = data.offlineBoostCost;
            if (data.offlineEmpire !== undefined) offlineEmpire = data.offlineEmpire;
            if (data.offlineEmpireCost !== undefined) offlineEmpireCost = data.offlineEmpireCost;
            if (data.offlineEfficiency !== undefined) offlineEfficiency = data.offlineEfficiency;
            if (data.offlineEfficiencyCost !== undefined) offlineEfficiencyCost = data.offlineEfficiencyCost;
            if (data.offlineHibernate !== undefined) offlineHibernate = data.offlineHibernate;
            if (data.offlineHibernateCost !== undefined) offlineHibernateCost = data.offlineHibernateCost;
            if (data.offlineTimeCapsule !== undefined) offlineTimeCapsule = data.offlineTimeCapsule;
            if (data.offlineTimeCapsuleCost !== undefined) offlineTimeCapsuleCost = data.offlineTimeCapsuleCost;
            if (data.lastSeenTime !== undefined) lastSeenTime = data.lastSeenTime;
          }
        }
      }
    } catch (e) {}
    try {
      const savedTheme = localStorage.getItem('kittenTheme');
      if (savedTheme) {
        userSettings.theme = savedTheme;
      }
    } catch (e) {}
    applyTheme(userSettings.theme);
    updateSettingsUI();
    updateUI();
    renderDynamicShop();
    renderBundles();
    renderAchievements();
    renderBreeds();
    updatePrestigeInfo();
    updatePlayerCount();
    startPlayerCountStream(); // Start real-time updates
    startHeartbeat(); // Start sending heartbeats
    
    // Ensure shop overlay is closed on page load
    const shopOverlay = document.getElementById('shopOverlay');
    if (shopOverlay) {
      shopOverlay.style.display = 'none';
    }
    applySeasonalDecorations();
    
    // Check for offline bonus
    if (lastSeenTime > 0) {
      showOfflineBonus();
    }
    
    // Update last seen time
    lastSeenTime = Date.now();
    saveProgress();
  });
  
  // Save to userlist every 5 seconds
  if (location.protocol !== 'file:' && navigator.onLine) {
    setInterval(() => {
      try {
        saveToUserList();
      } catch (e) {}
    }, 5000);
  }

  // --- MYSTERY KITTEN RANDOM SPAWN ---
  let mysteryKittenTimeout = null;
  function scheduleMysteryKitten() {
    const randomDelay = Math.floor(Math.random() * 1000); // 0-999 ms
    // For debug: const randomDelay = (10 + Math.random()*20)*1000;\
    mysteryKittenTimeout = setTimeout(() => {
      mysteryKittenBtn.style.display = '';
    }, randomDelay);
  }
  
  // Hide the button & schedule first appearance on page load
  window.addEventListener('load', () => {
    mysteryKittenBtn.style.display = 'none';
    if(mysteryKittenTimeout) clearTimeout(mysteryKittenTimeout);
    scheduleMysteryKitten();
  });

  // MYSTERY KITTEN BUTTON LOGIC
  mysteryKittenBtn.addEventListener('click', function() {
    if (kittens < 1) {
      showNotification('You need some kittens to risk!');
      return;
    }
    window.usedMysteryKitten = true;
    const rand = Math.random();
    if (rand < 0.5) {
      const gain = Math.floor(kittens * 0.17);
      kittens += gain;
      if(userSettings.floatScore) showFloatingScore(gain);
      showNotification(`Mystery Kitten! You gained +${gain} kittens!`);
    } else if (rand < 0.67) {
      const loss = Math.floor(kittens * 0.17);
      kittens -= loss;
      if (kittens < 0) kittens = 0;
      if(userSettings.floatScore) showFloatingScore(-loss);
      showNotification(`Oh no! Mystery Kitten took -${loss} kittens!`);
    } else {
      showNotification('Mystery Kitten did nothing this time.');
    }
    updateUI();
    checkAchievements();
    // Hide the button and schedule the next spawn
    this.style.display = 'none';
    if (mysteryKittenTimeout) clearTimeout(mysteryKittenTimeout);
    scheduleMysteryKitten();
  });

  // --- CONSOLE FUNCTIONALITY ---
  let developerMode = false;
  
  // Developer mode toggle using Ctrl+Shift+D
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey && e.key === 'D') {
      developerMode = !developerMode;
      document.getElementById('consoleInput').style.display = developerMode ? 'block' : 'none';
      document.getElementById('consoleButton').style.display = developerMode ? 'block' : 'none';
      if (developerMode) {
        showNotification('Developer mode enabled');
      } else {
        showNotification('Developer mode disabled');
      }
    }
  });
  
  function executeConsoleCommand() {
    if (!developerMode) return;
    
    const input = document.getElementById('consoleInput');
    const output = document.getElementById('consoleOutput');
    const command = input.value.trim().toLowerCase();
    
    if (!command) return;
    
    // Add command to output
    const commandLine = document.createElement('div');
    commandLine.textContent = '> ' + command;
    commandLine.style.color = '#1565c0';
    output.appendChild(commandLine);
    
    try {
      if (command.startsWith('qwertycps=')) {
        const value = parseFloat(command.substring(10));
        if (isNaN(value) || value < 0) {
          throw new Error('Invalid CPS value');
        }
        // Set CPS to the specified value
        upgrades.autoClicker = Math.floor(value / 5);
        upgrades.autoKittenFarm = Math.floor(value / 7);
        upgrades.kittenPlanet = Math.floor(value / 30);
        updateUI();
        output.appendChild(createOutputLine(`CPS set to ${value}`));
      } else if (command.startsWith('qwertycv=')) {
        const value = parseFloat(command.substring(9));
        if (isNaN(value) || value < 0) {
          throw new Error('Invalid CV value');
        }
        // Set click value to the specified value
        clickValue = value;
        updateUI();
        output.appendChild(createOutputLine(`Click Value set to ${value}`));
      } else {
        throw new Error('Unknown command. Use qwertycps=number or qwertycv=number');
      }
    } catch (error) {
      output.appendChild(createOutputLine(`Error: ${error.message}`, 'red'));
    }
    
    // Scroll to bottom
    output.scrollTop = output.scrollHeight;
    
    // Clear input
    input.value = '';
  }

  function createOutputLine(text, color = '#00796b') {
    const line = document.createElement('div');
    line.textContent = text;
    line.style.color = color;
    return line;
  }

  // Add event listener to console input
  (function(){
    const ci = document.getElementById('consoleInput');
    if (ci) {
      ci.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          executeConsoleCommand();
        }
      });
    }
  })();

  // Update player count periodically (fallback)
  setInterval(updatePlayerCount, 30000);

  // --- SHOP OPENING LOGIC ---
  // Shop is now opened via openOverlay() function like other overlays

  function setCookie(name, value, days) {
    const expires = new Date(Date.now() + days * 86400000).toUTCString();
    let attrs = 'path=/; SameSite=Lax';
    if (location.protocol === 'https:') attrs += '; Secure';
    document.cookie = name + '=' + value + '; expires=' + expires + '; ' + attrs;
  }

  function getCookie(name) {
    const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/[-.\\[\\]{}()*+?^$|]/g, '\\$&') + '=([^;]*)'));
    return m ? m[1] : null;
  }

  function saveCookies() {
    try {
      setCookie('kc_kittens', String(kittens), 365);
      setCookie('kc_clickValue', String(clickValue), 365);
      setCookie('kc_upgrades', encodeURIComponent(JSON.stringify(upgrades)), 365);
      setCookie('kc_upgradeCosts', encodeURIComponent(JSON.stringify(upgradeCosts)), 365);
      setCookie('kc_selectedBreed', selectedBreed, 365);
      setCookie('kc_breedsUnlocked', encodeURIComponent(JSON.stringify(breedsUnlocked)), 365);
      setCookie('kc_achievementsData', encodeURIComponent(JSON.stringify(achievementsData.map(a => ({ id: a.id, achieved: a.achieved })))), 365);
      setCookie('kc_userSettings', encodeURIComponent(JSON.stringify(userSettings)), 365);
      setCookie('kc_bonusUpgrades', encodeURIComponent(JSON.stringify(bonusUpgrades)), 365);
      setCookie('kc_bonusUpgradeCosts', encodeURIComponent(JSON.stringify(bonusUpgradeCosts)), 365);
      setCookie('kc_prestigeLevel', String(prestigeLevel), 365);
      setCookie('kc_offline', encodeURIComponent(JSON.stringify({ offlineClicks, offlineClickCost, offlineBoost, offlineBoostCost, offlineEmpire, offlineEmpireCost, offlineEfficiency, offlineEfficiencyCost, offlineHibernate, offlineHibernateCost, offlineTimeCapsule, offlineTimeCapsuleCost, lastSeenTime })), 365);
    } catch (e) {}
  }

  function loadFromCookies() {
    try {
      const ck = getCookie('kc_kittens');
      if (!ck) return false;
      kittens = parseFloat(ck) || 0;
      const cv = getCookie('kc_clickValue');
      if (cv) clickValue = parseFloat(cv) || 1;
      const up = getCookie('kc_upgrades');
      if (up) upgrades = JSON.parse(decodeURIComponent(up));
      const uc = getCookie('kc_upgradeCosts');
      if (uc) upgradeCosts = JSON.parse(decodeURIComponent(uc));
      const sb = getCookie('kc_selectedBreed');
      if (sb) selectedBreed = sb;
      const bu = getCookie('kc_breedsUnlocked');
      if (bu) breedsUnlocked = JSON.parse(decodeURIComponent(bu));
      const ad = getCookie('kc_achievementsData');
      if (ad) {
        const arr = JSON.parse(decodeURIComponent(ad));
        if (Array.isArray(arr)) {
          for (let ach of arr) {
            const found = achievementsData.find(a => a.id === ach.id);
            if (found) found.achieved = !!ach.achieved;
          }
        }
      }
      const us = getCookie('kc_userSettings');
      if (us) userSettings = JSON.parse(decodeURIComponent(us));
      const bup = getCookie('kc_bonusUpgrades');
      if (bup) bonusUpgrades = JSON.parse(decodeURIComponent(bup));
      const buc = getCookie('kc_bonusUpgradeCosts');
      if (buc) bonusUpgradeCosts = JSON.parse(decodeURIComponent(buc));
      const pl = getCookie('kc_prestigeLevel');
      if (pl) prestigeLevel = parseInt(pl) || 0;
      const off = getCookie('kc_offline');
      if (off) {
        const o = JSON.parse(decodeURIComponent(off));
        if (o.offlineClicks !== undefined) offlineClicks = o.offlineClicks;
        if (o.offlineClickCost !== undefined) offlineClickCost = o.offlineClickCost;
        if (o.offlineBoost !== undefined) offlineBoost = o.offlineBoost;
        if (o.offlineBoostCost !== undefined) offlineBoostCost = o.offlineBoostCost;
        if (o.offlineEmpire !== undefined) offlineEmpire = o.offlineEmpire;
        if (o.offlineEmpireCost !== undefined) offlineEmpireCost = o.offlineEmpireCost;
        if (o.offlineEfficiency !== undefined) offlineEfficiency = o.offlineEfficiency;
        if (o.offlineEfficiencyCost !== undefined) offlineEfficiencyCost = o.offlineEfficiencyCost;
        if (o.offlineHibernate !== undefined) offlineHibernate = o.offlineHibernate;
        if (o.offlineHibernateCost !== undefined) offlineHibernateCost = o.offlineHibernateCost;
        if (o.offlineTimeCapsule !== undefined) offlineTimeCapsule = o.offlineTimeCapsule;
        if (o.offlineTimeCapsuleCost !== undefined) offlineTimeCapsuleCost = o.offlineTimeCapsuleCost;
        if (o.lastSeenTime !== undefined) lastSeenTime = o.lastSeenTime;
      }
      return true;
    } catch (e) { return false; }
  }

  function saveProgress() {
    try {
      lastSeenTime = Date.now();
      const saveData = {
        kittens,
        clickValue,
        upgrades,
        upgradeCosts,
        selectedBreed,
        breedsUnlocked,
        achievementsData,
        userSettings,
        bonusUpgrades,
        bonusUpgradeCosts,
        prestigeLevel,
        offlineClicks,
        offlineClickCost,
        offlineBoost,
        offlineBoostCost,
        offlineEmpire,
        offlineEmpireCost,
        offlineEfficiency,
        offlineEfficiencyCost,
        offlineHibernate,
        offlineHibernateCost,
        offlineTimeCapsule,
        offlineTimeCapsuleCost,
        lastSeenTime
      };
      localStorage.setItem('kittenSave', JSON.stringify(saveData));
      saveCookies();
    } catch (e) {}
  }

  setInterval(saveProgress, 5000);

  document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
      saveProgress();
    }
  });

  window.addEventListener('beforeunload', function() {
    saveProgress();
  });
  window.addEventListener('pagehide', function() {
    saveProgress();
  });

  // --- PRESTIGE LOGIC ---
  prestigeButton.addEventListener('click', function() {
    const requirement = Math.pow(10, 6 + prestigeLevel);
    if (kittens >= requirement) {
      // Apply prestige bonuses
      prestigeLevel++;
      
      // Reset kittens and upgrades but keep prestige bonuses
      kittens = 0;
      clickValue = 1;
      upgrades = {milkBowl:0,catFood:0,scratcher:0,kittenFactory:0,cityOfKittens:0,worldOfMeows:0,autoClicker:0,autoKittenFarm:0,kittenPlanet:0,goldKitty:0,nebulaCursor:0,starForge:0};
      upgradeCosts = {milkBowl:15,catFood:50,scratcher:200,kittenFactory:1000,cityOfKittens:5000,worldOfMeows:25000,autoClicker:100,autoKittenFarm:500,kittenPlanet:10000,goldKitty:500000,nebulaCursor:250000,starForge:1000000};
      
      // Show notification
      showNotification(`Prestige Level ${prestigeLevel}! Bonuses applied.`);

      // Update UI
      updateUI();
      renderDynamicShop();
      renderBundles();
      updatePrestigeInfo();
    }
  });
</script>
</body>
</html>
